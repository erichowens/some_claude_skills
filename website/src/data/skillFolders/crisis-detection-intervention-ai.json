{
  "name": "crisis-detection-intervention-ai",
  "type": "folder",
  "path": "crisis-detection-intervention-ai",
  "children": [
    {
      "name": "assets",
      "type": "folder",
      "path": "crisis-detection-intervention-ai/assets",
      "children": []
    },
    {
      "name": "references",
      "type": "folder",
      "path": "crisis-detection-intervention-ai/references",
      "children": [
        {
          "name": "crisis-resources.md",
          "type": "file",
          "path": "crisis-detection-intervention-ai/references/crisis-resources.md",
          "size": 14127,
          "content": "# Crisis Resources\n\nComprehensive directory of crisis hotlines, support services, and integration patterns.\n\n## Primary Crisis Resources (United States)\n\n### 988 Suicide & Crisis Lifeline\n\n**Phone**: 988 (available 24/7)\n**Website**: https://988lifeline.org/\n**Chat**: https://988lifeline.org/chat\n**Languages**: English, Spanish (press 2)\n\n**What they provide**:\n- Immediate crisis counseling\n- Suicide prevention\n- Emotional support\n- Local resource referrals\n\n**Response time**: &lt;1 minute\n\n**Integration**:\n```typescript\n// Modal display\nconst crisis988Modal = {\n  title: '988 Suicide & Crisis Lifeline',\n  message: 'Free, confidential support 24/7 for people in distress.',\n  actions: [\n    { label: 'Call 988', action: 'tel:988', primary: true },\n    { label: 'Chat Online', action: 'https://988lifeline.org/chat' },\n    { label: 'Text Support', action: 'sms:988' }\n  ]\n};\n```\n\n---\n\n### Crisis Text Line\n\n**Text**: Text \"HELLO\" to 741741\n**Website**: https://www.crisistextline.org/\n**Available**: 24/7 in US, Canada, UK, Ireland\n\n**What they provide**:\n- Text-based crisis support\n- Trained crisis counselors\n- De-escalation techniques\n- Resource referrals\n\n**Response time**: &lt;5 minutes\n\n**Integration**:\n```typescript\n// Direct SMS link\n<a href=\"sms:741741&body=HELLO\">Text Crisis Line</a>\n\n// Or programmatic\nwindow.location.href = 'sms:741741&body=HELLO';\n```\n\n---\n\n### SAMHSA National Helpline (Substance Abuse)\n\n**Phone**: 1-800-662-HELP (4357)\n**Website**: https://www.samhsa.gov/find-help/national-helpline\n**Available**: 24/7, 365 days/year\n**Languages**: English, Spanish\n\n**What they provide**:\n- Treatment referrals\n- Information services\n- Support groups\n- Local resources for substance abuse and mental health\n\n**Integration**:\n```typescript\nconst samhsaResource = {\n  name: 'SAMHSA National Helpline',\n  description: 'Free, confidential help for substance abuse 24/7',\n  phone: '1-800-662-4357',\n  action: 'tel:+18006624357',\n  useCase: 'substance_relapse'\n};\n```\n\n---\n\n### National Domestic Violence Hotline\n\n**Phone**: 1-800-799-SAFE (7233)\n**Website**: https://www.thehotline.org/\n**Chat**: Available on website\n**Text**: Text \"START\" to 88788\n\n**What they provide**:\n- Safety planning\n- Crisis intervention\n- Local shelter referrals\n- Legal advocacy information\n\n---\n\n### Veterans Crisis Line\n\n**Phone**: 988, then press 1\n**Text**: 838255\n**Chat**: https://www.veteranscrisisline.net/\n\n**What they provide**:\n- Crisis support for veterans\n- Military-specific counseling\n- Family support\n- VA resource connection\n\n---\n\n### LGBTQ+ Specific\n\n**Trevor Project** (LGBTQ+ youth under 25):\n- Phone: 1-866-488-7386\n- Text: Text \"START\" to 678678\n- Chat: https://www.thetrevorproject.org/\n\n**Trans Lifeline**:\n- US: 1-877-565-8860\n- Canada: 1-877-330-6366\n\n---\n\n## International Crisis Resources\n\n### Canada\n\n**Crisis Services Canada**:\n- Phone: 1-833-456-4566\n- Text: 45645\n- Website: https://www.crisisservicescanada.ca/\n\n**Kids Help Phone** (youth):\n- Phone: 1-800-668-6868\n- Text: 686868\n\n---\n\n### United Kingdom\n\n**Samaritans**:\n- Phone: 116 123\n- Email: jo@samaritans.org\n- Website: https://www.samaritans.org/\n\n**Shout** (text):\n- Text: 85258\n\n---\n\n### Australia\n\n**Lifeline**:\n- Phone: 13 11 14\n- Chat: https://www.lifeline.org.au/\n\n**Beyond Blue**:\n- Phone: 1300 22 4636\n\n---\n\n### Europe\n\n**Befrienders Worldwide**:\n- International directory: https://www.befrienders.org/\n\n**Specific Countries**:\n- Germany: 0800 111 0 111\n- France: 01 45 39 40 00\n- Spain: 91 459 00 50\n- Italy: 800 86 00 22\n\n---\n\n## Specialized Resources\n\n### Eating Disorders\n\n**National Eating Disorders Association (NEDA)**:\n- Helpline: 1-800-931-2237\n- Text: Text \"NEDA\" to 741741\n- Website: https://www.nationaleatingdisorders.org/\n\n---\n\n### Postpartum Depression\n\n**Postpartum Support International**:\n- Helpline: 1-800-944-4773\n- Website: https://www.postpartum.net/\n\n---\n\n### Disaster Distress\n\n**SAMHSA Disaster Distress Helpline**:\n- Phone: 1-800-985-5990\n- Text: \"TalkWithUs\" to 66746\n\n---\n\n### Youth/Children\n\n**Boys Town National Hotline**:\n- Phone: 1-800-448-3809\n- Available: 24/7\n\n**National Runaway Safeline**:\n- Phone: 1-800-786-2929\n- Text: 66008\n\n---\n\n## Integration Patterns\n\n### Pattern 1: Contextual Resource Display\n\n**Show relevant resources based on detected signal**:\n\n```typescript\nfunction getRelevantResources(signals: CrisisSignal[]): Resource[] {\n  const resources: Resource[] = [];\n\n  // Always include 988\n  resources.push({\n    name: '988 Suicide & Crisis Lifeline',\n    phone: '988',\n    description: 'Free, confidential support 24/7',\n    action: 'tel:988',\n    priority: 1\n  });\n\n  // Add signal-specific resources\n  if (signals.some(s => s.type === 'substance_relapse')) {\n    resources.push({\n      name: 'SAMHSA National Helpline',\n      phone: '1-800-662-4357',\n      description: 'Substance abuse support',\n      action: 'tel:+18006624357',\n      priority: 2\n    });\n  }\n\n  if (signals.some(s => s.type === 'suicidal_ideation')) {\n    resources.push({\n      name: 'Crisis Text Line',\n      description: 'Text support with trained counselor',\n      action: 'sms:741741&body=HELLO',\n      priority: 2\n    });\n  }\n\n  return resources.sort((a, b) => a.priority - b.priority);\n}\n```\n\n---\n\n### Pattern 2: Location-Based Resources\n\n**Show local resources based on user location**:\n\n```typescript\ninterface LocalResource {\n  name: string;\n  phone: string;\n  address: string;\n  hours: string;\n  services: string[];\n  distance?: number;\n}\n\nasync function getLocalResources(\n  zipCode: string,\n  serviceType: 'crisis' | 'therapy' | 'substance_abuse'\n): Promise<LocalResource[]> {\n  // Use SAMHSA Treatment Locator API\n  const response = await fetch(\n    `https://findtreatment.samhsa.gov/locator/api/v1/facilities?zip=${zipCode}&type=${serviceType}`\n  );\n\n  const facilities = await response.json();\n\n  return facilities.map(f => ({\n    name: f.name,\n    phone: f.phone,\n    address: f.address,\n    hours: f.hours,\n    services: f.services,\n    distance: f.distance\n  }));\n}\n```\n\n**SAMHSA API**: https://findtreatment.samhsa.gov/locator/api\n\n---\n\n### Pattern 3: Multi-Channel Support\n\n**Allow users to choose their preferred contact method**:\n\n```typescript\ninterface ContactMethod {\n  type: 'phone' | 'text' | 'chat' | 'email';\n  label: string;\n  action: string;\n  responseTime: string;\n}\n\nconst crisis988Channels: ContactMethod[] = [\n  {\n    type: 'phone',\n    label: 'Call 988',\n    action: 'tel:988',\n    responseTime: '&lt;1 minute'\n  },\n  {\n    type: 'text',\n    label: 'Text 988',\n    action: 'sms:988',\n    responseTime: '&lt;5 minutes'\n  },\n  {\n    type: 'chat',\n    label: 'Chat Online',\n    action: 'https://988lifeline.org/chat',\n    responseTime: '&lt;5 minutes'\n  }\n];\n\n// Display as user preference\nfunction ResourceModal({ channels }: { channels: ContactMethod[] }) {\n  return (\n    <div>\n      <h2>How would you like to connect?</h2>\n      {channels.map(channel => (\n        <button key={channel.type} onClick={() => window.location.href = channel.action}>\n          {channel.label}\n          <span className=\"response-time\">{channel.responseTime}</span>\n        </button>\n      ))}\n    </div>\n  );\n}\n```\n\n---\n\n### Pattern 4: Resource Tracking\n\n**Track which resources users engage with**:\n\n```typescript\ninterface ResourceEngagement {\n  userId: string;\n  resourceName: string;\n  contactMethod: 'phone' | 'text' | 'chat';\n  timestamp: Date;\n  fromDetection?: string;  // Detection ID if from crisis detection\n}\n\nasync function trackResourceEngagement(\n  userId: string,\n  resource: Resource,\n  detectionId?: string\n): Promise<void> {\n  await db.resource_engagement.insert({\n    user_id: userId,\n    resource_name: resource.name,\n    contact_method: resource.type,\n    timestamp: new Date(),\n    from_detection: detectionId\n  });\n\n  // Update crisis detection record\n  if (detectionId) {\n    await db.crisis_detections.update(detectionId, {\n      resource_engaged: true,\n      resource_name: resource.name,\n      engaged_at: new Date()\n    });\n  }\n}\n```\n\n**Benefits**:\n- Measure resource effectiveness\n- Identify which resources users prefer\n- Correlate resource use with outcomes\n\n---\n\n### Pattern 5: Offline Support (For App Downtime)\n\n**Cache resources locally for offline access**:\n\n```typescript\n// Service Worker caching\nself.addEventListener('install', (event) => {\n  event.waitUntil(\n    caches.open('crisis-resources-v1').then(cache => {\n      return cache.addAll([\n        '/crisis-resources.html',\n        '/crisis-resources.json'\n      ]);\n    })\n  );\n});\n\n// Static crisis resources page (always available)\nconst offlineResources = `\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Crisis Resources</title>\n</head>\n<body>\n  <h1>üÜò Crisis Resources Available 24/7</h1>\n\n  <section>\n    <h2&gt;988 Suicide & Crisis Lifeline</h2>\n    <a href=\"tel:988\" class=\"primary-action\">Call 988</a>\n    <p>Free, confidential support 24/7</p>\n  </section>\n\n  <section>\n    <h2>Crisis Text Line</h2>\n    <a href=\"sms:741741&body=HELLO\">Text HELLO to 741741</a>\n    <p>Text support with trained counselor</p>\n  </section>\n\n  <!-- More resources -->\n</body>\n</html>\n`;\n```\n\n---\n\n## Mobile App Integration\n\n### Deep Linking\n\n**Allow direct app-to-app communication**:\n\n```typescript\n// iOS\nconst iosDeepLinks = {\n  phone: 'tel:988',\n  messages: 'sms:741741&body=HELLO',\n  safari: 'https://988lifeline.org/chat'\n};\n\n// Android\nconst androidDeepLinks = {\n  phone: 'tel:988',\n  messages: 'sms:741741?body=HELLO',\n  browser: 'https://988lifeline.org/chat'\n};\n\n// React Native\nimport { Linking } from 'react-native';\n\nfunction callCrisisLine() {\n  Linking.openURL('tel:988');\n}\n\nfunction textCrisisLine() {\n  const url = Platform.OS === 'ios'\n    ? 'sms:741741&body=HELLO'\n    : 'sms:741741?body=HELLO';\n  Linking.openURL(url);\n}\n```\n\n---\n\n### Push Notifications\n\n**Proactive check-ins for high-risk users**:\n\n```typescript\n// Schedule check-in notification\nasync function scheduleCheckIn(userId: string, hoursFromNow: number): Promise<void> {\n  await scheduleNotification({\n    userId,\n    title: 'Quick Check-In',\n    body: 'How are you feeling today? We\\'re here if you need support.',\n    scheduledFor: new Date(Date.now() + hoursFromNow * 60 * 60 * 1000),\n    actions: [\n      { id: 'talk', title: 'I\\'d like to talk' },\n      { id: 'resources', title: 'Show resources' },\n      { id: 'dismiss', title: 'I\\'m doing okay' }\n    ]\n  });\n}\n\n// Handle notification response\nnotificationHandler.on('action', async (action, notification) => {\n  switch (action.id) {\n    case 'talk':\n      // Connect to crisis counselor\n      await connectToCounselor(notification.userId);\n      break;\n    case 'resources':\n      // Show crisis resources\n      showCrisisResources(notification.userId);\n      break;\n    case 'dismiss':\n      // Log as positive check-in\n      await logCheckIn(notification.userId, 'positive');\n      break;\n  }\n});\n```\n\n---\n\n## Resource Effectiveness Metrics\n\n**Track outcomes to improve resource recommendations**:\n\n```sql\n-- Resource engagement tracking\nCREATE TABLE resource_engagements (\n  id UUID PRIMARY KEY,\n  user_id UUID NOT NULL,\n  resource_name VARCHAR(255),\n  contact_method VARCHAR(50),\n  engaged_at TIMESTAMP,\n  from_detection_id UUID,  -- Link to crisis detection\n\n  -- Outcome tracking\n  followed_up BOOLEAN,  -- Did user follow up with counselor?\n  helpful_rating INTEGER,  -- 1-5 scale\n  outcome_notes TEXT\n);\n\n-- Query: Which resources are most effective?\nSELECT\n  resource_name,\n  contact_method,\n  COUNT(*) as engagements,\n  AVG(helpful_rating) as avg_rating,\n  SUM(CASE WHEN followed_up THEN 1 ELSE 0 END) as follow_ups\nFROM resource_engagements\nWHERE engaged_at > NOW() - INTERVAL '30 days'\nGROUP BY resource_name, contact_method\nORDER BY avg_rating DESC, engagements DESC;\n```\n\n---\n\n## Accessibility Considerations\n\n### Language Support\n\n```typescript\nconst resources988ByLanguage = {\n  en: {\n    phone: '988',\n    description: 'Free, confidential support 24/7'\n  },\n  es: {\n    phone: '988',\n    instructions: 'Press 2 for Spanish',\n    description: 'Apoyo gratuito y confidencial 24/7'\n  },\n  zh: {\n    // Chinese language resources\n    phone: '1-800-273-8255',  // Alternate number with Chinese support\n    description: 'ÂÖçË¥π„ÄÅ‰øùÂØÜÁöÑÊîØÊåÅ 24/7'\n  }\n};\n```\n\n### Disability Access\n\n- **Screen reader compatible**: All resources have alt text\n- **TTY/TDD**: 1-800-799-4889 (Deaf/Hard of Hearing)\n- **Video relay**: Available through 988 website\n\n---\n\n## Privacy & Security\n\n**Resource engagement is PHI**:\n\n```typescript\n// Encrypt resource engagement data\nconst encryptedEngagement = await encrypt({\n  userId: hashUserId(user.id),  // Hash, not plain ID\n  resourceName: resource.name,\n  timestamp: Date.now()\n}, process.env.CRISIS_DATA_KEY);\n\n// Log access\nawait logAccess({\n  resourceId: resource.id,\n  accessedBy: 'system',\n  accessType: 'engagement_tracking',\n  timestamp: Date.now()\n});\n\n// Auto-delete after 30 days\nawait scheduleDelete({\n  table: 'resource_engagements',\n  recordId: engagement.id,\n  deleteAt: Date.now() + (30 * 24 * 60 * 60 * 1000)\n});\n```\n\n---\n\n## Testing Resource Integration\n\n```typescript\ndescribe('Crisis Resources', () => {\n  it('shows 988 for all crisis severities', () => {\n    const resources = getRelevantResources([\n      { type: 'suicidal_ideation', confidence: 0.9 }\n    ]);\n\n    expect(resources[0].phone).toBe('988');\n  });\n\n  it('includes SAMHSA for substance relapse', () => {\n    const resources = getRelevantResources([\n      { type: 'substance_relapse', confidence: 0.8 }\n    ]);\n\n    expect(resources.some(r => r.name.includes('SAMHSA'))).toBe(true);\n  });\n\n  it('tracks resource engagement', async () => {\n    await trackResourceEngagement('user-123', {\n      name: '988 Lifeline',\n      type: 'phone'\n    });\n\n    const engagements = await db.resource_engagements.find({ user_id: 'user-123' });\n    expect(engagements.length).toBe(1);\n  });\n});\n```\n\n---\n\n## Resources\n\n- [988 Lifeline](https://988lifeline.org/)\n- [SAMHSA Treatment Locator](https://findtreatment.samhsa.gov/)\n- [Crisis Text Line](https://www.crisistextline.org/)\n- [Befrienders Worldwide](https://www.befrienders.org/) (International)\n"
        },
        {
          "name": "intervention-protocols.md",
          "type": "file",
          "path": "crisis-detection-intervention-ai/references/intervention-protocols.md",
          "size": 12751,
          "content": "# Crisis Intervention Protocols\n\nEvidence-based intervention strategies for mental health crisis response.\n\n## Overview\n\n**Critical Rule**: AI detects, humans intervene.\n\n**Timeline**: From detection to human contact should be &lt;15 minutes for immediate crises.\n\n---\n\n## Severity-Based Response Matrix\n\n| Severity | Response Time | Actions | Human Involvement |\n|----------|---------------|---------|-------------------|\n| **Immediate** | &lt;5 minutes | 988 modal (blocking), notify on-call, SMS backup | Required immediately |\n| **High** | &lt;1 hour | Crisis resources, notify on-call, email backup | Required within 1 hour |\n| **Medium** | &lt;24 hours | In-app resources, add to review queue | Review next business day |\n| **Low** | &lt;72 hours | Supportive resources, add to queue | Review within 3 days |\n| **None** | N/A | No action | No action |\n\n---\n\n## Protocol 1: Immediate Danger (Suicidal Ideation)\n\n**Trigger**: `severity === 'immediate'`\n\n**Automated Actions** (run immediately):\n\n```typescript\nasync function handleImmediateCrisis(detection: CrisisDetection): Promise<void> {\n  // 1. Show 988 modal (blocking, user must acknowledge)\n  await show988Modal({\n    userId: detection.userId,\n    dismissible: false,  // User must click \"I understand\"\n    resources: [\n      { name: '988 Suicide & Crisis Lifeline', action: 'tel:988' },\n      { name: 'Crisis Text Line', action: 'sms:741741', message: 'HELLO' },\n      { name: 'Chat with counselor', action: 'https://988lifeline.org/chat' }\n    ]\n  });\n\n  // 2. Notify on-call crisis counselor (push notification)\n  await notifyOnCallCounselor({\n    userId: detection.userId,\n    severity: 'immediate',\n    text: detection.text,\n    signals: detection.signals,\n    requiresResponse: 'immediate',\n    escalationTime: Date.now()\n  });\n\n  // 3. SMS backup if no response in 5 minutes\n  setTimeout(async () => {\n    const responded = await checkCounselorResponse(detection.id);\n    if (!responded) {\n      await sendSMSToBackupCounselor({\n        message: `IMMEDIATE: ${detection.userId} crisis detected. No primary response in 5 min.`,\n        detectionId: detection.id\n      });\n    }\n  }, 5 * 60 * 1000);\n\n  // 4. Log for audit\n  await logCrisisEvent({\n    detectionId: detection.id,\n    severity: 'immediate',\n    actions: ['988_modal_shown', 'on_call_notified'],\n    timestamp: Date.now()\n  });\n}\n```\n\n**Human Response** (counselor script):\n\n1. **Immediate outreach** (within 5 minutes):\n   - \"Hi [name], I'm [counselor name], a crisis counselor. I saw your recent message and I'm here to help. Are you safe right now?\"\n\n2. **Assess immediate danger**:\n   - \"Do you have a plan to hurt yourself?\"\n   - \"Are you alone right now?\"\n   - \"Do you have access to means (pills, weapons)?\"\n\n3. **Safety planning**:\n   - If danger: \"Let's call 988 together right now.\"\n   - If no immediate danger: \"Can we create a safety plan together?\"\n\n4. **Follow-up**:\n   - Schedule check-in within 24 hours\n   - Connect to ongoing therapy resources\n\n---\n\n## Protocol 2: High Risk (Self-Harm, Suicidal Thoughts)\n\n**Trigger**: `severity === 'high'`\n\n**Automated Actions**:\n\n```typescript\nasync function handleHighRisk(detection: CrisisDetection): Promise<void> {\n  // 1. Show crisis resources (dismissible modal)\n  await showCrisisResourcesModal({\n    userId: detection.userId,\n    dismissible: true,\n    resources: [\n      { name: '988 Suicide & Crisis Lifeline', action: 'tel:988' },\n      { name: 'Crisis Text Line', action: 'sms:741741' },\n      { name: 'Chat Now', action: 'https://988lifeline.org/chat' },\n      { name: 'Find Therapist', action: '/find-therapist' }\n    ],\n    message: 'We noticed you might be going through a tough time. Here are resources available 24/7.'\n  });\n\n  // 2. Notify on-call counselor (email + push)\n  await notifyOnCallCounselor({\n    severity: 'high',\n    requiresResponse: '1 hour',\n    channels: ['email', 'push']\n  });\n\n  // 3. Add to urgent review queue\n  await addToReviewQueue({\n    priority: 'urgent',\n    reviewBy: Date.now() + (1 * 60 * 60 * 1000)  // 1 hour\n  });\n}\n```\n\n**Human Response** (within 1 hour):\n\n1. **Empathetic outreach**:\n   - \"Hi [name], I'm checking in because I care about how you're doing. How are you feeling right now?\"\n\n2. **Non-judgmental listening**:\n   - Validate feelings: \"It sounds like you're going through a really difficult time.\"\n   - Ask open-ended questions: \"What's been happening that's making you feel this way?\"\n\n3. **Risk assessment**:\n   - \"Have you thought about hurting yourself?\"\n   - \"What's stopped you so far?\" (identify protective factors)\n\n4. **Resource connection**:\n   - Offer to help schedule therapy appointment\n   - Provide crisis line info if not already provided\n   - Create safety plan if appropriate\n\n---\n\n## Protocol 3: Medium Risk (Substance Relapse)\n\n**Trigger**: `severity === 'medium'`\n\n**Automated Actions**:\n\n```typescript\nasync function handleMediumRisk(detection: CrisisDetection): Promise<void> {\n  // 1. Show in-app resources (non-blocking)\n  await showInAppResources({\n    userId: detection.userId,\n    type: 'supportive',\n    resources: [\n      { name: 'Talk to Sponsor', action: '/contacts/sponsor' },\n      { name: 'Find a Meeting', action: '/meetings/nearby' },\n      { name: 'Call Support Line', action: 'tel:1-800-662-4357' },  // SAMHSA\n      { name: 'Coping Strategies', action: '/resources/coping' }\n    ]\n  });\n\n  // 2. Flag for review (next business day)\n  await addToReviewQueue({\n    priority: 'high',\n    reviewBy: getNextBusinessDay()\n  });\n\n  // 3. Suggest self-help actions\n  await suggestActions({\n    userId: detection.userId,\n    actions: [\n      'Reach out to your sponsor',\n      'Attend a meeting today',\n      'Practice grounding techniques',\n      'Call a supportive friend'\n    ]\n  });\n}\n```\n\n**Human Response** (within 24 hours):\n\n1. **Supportive check-in**:\n   - \"Hi [name], how are you doing today?\"\n\n2. **Assess situation**:\n   - \"I saw you mentioned [relapse/cravings]. Want to talk about it?\"\n   - \"What triggered this?\"\n\n3. **Action planning**:\n   - \"What's one thing you can do today to support your recovery?\"\n   - \"Have you been to a meeting recently?\"\n   - \"Is your sponsor aware?\"\n\n4. **Resource connection**:\n   - Remind about support group schedule\n   - Share coping strategies\n   - Schedule follow-up\n\n---\n\n## Protocol 4: Low Risk (General Distress)\n\n**Trigger**: `severity === 'low'`\n\n**Automated Actions**:\n\n```typescript\nasync function handleLowRisk(detection: CrisisDetection): Promise<void> {\n  // 1. Offer supportive resources (subtle, non-intrusive)\n  await showResources({\n    userId: detection.userId,\n    placement: 'sidebar',  // Not blocking\n    resources: [\n      { name: 'Self-Care Tips', action: '/resources/self-care' },\n      { name: 'Mindfulness Exercises', action: '/resources/mindfulness' },\n      { name: 'Community Support', action: '/community' }\n    ]\n  });\n\n  // 2. Add to review queue (normal priority)\n  await addToReviewQueue({\n    priority: 'normal',\n    reviewBy: Date.now() + (3 * 24 * 60 * 60 * 1000)  // 3 days\n  });\n}\n```\n\n**Human Response** (within 72 hours):\n\n1. **Casual check-in**:\n   - \"Hey [name], just checking in. How's your week going?\"\n\n2. **Light conversation**:\n   - Listen without pushing for crisis disclosure\n   - Offer general support\n\n3. **Resource awareness**:\n   - \"Just wanted to remind you we have [resource] available if you ever need it.\"\n\n---\n\n## Special Protocol: Substance Relapse\n\n**Unique considerations**: Shame, guilt, fear of judgment\n\n**DO**:\n- ‚úÖ Normalize relapse as part of recovery journey\n- ‚úÖ Focus on getting back on track, not dwelling on slip\n- ‚úÖ Connect to sponsor/support group immediately\n- ‚úÖ Celebrate previous sobriety streak (e.g., \"6 months is amazing!\")\n\n**DON'T**:\n- ‚ùå Express disappointment or judgment\n- ‚ùå Ask \"why did you do it?\" (increases shame)\n- ‚ùå Minimize: \"It's just one slip\"\n\n**Script**:\n```\n\"Hey [name], I saw you mentioned using again. First, I want you to know\nthat reaching out takes courage. Relapse is a part of recovery for many\npeople, and it doesn't erase the progress you've made.\n\n[6 months sober] is a huge accomplishment. That shows you have the\nstrength to do this.\n\nWhat can we do right now to support you? Would it help to:\n- Call your sponsor?\n- Find a meeting today?\n- Talk through what triggered this?\n\nYou're not alone in this.\"\n```\n\n---\n\n## Escalation Chain\n\n**If primary on-call counselor doesn't respond**:\n\n```\n0-5 min:   Primary on-call notified (push notification)\n5-10 min:  Backup on-call notified (SMS)\n10-15 min: Clinical supervisor notified (phone call)\n15+ min:   Emergency protocol (suggest user call 988 directly)\n```\n\n**Implementation**:\n\n```typescript\nasync function escalateIfNoResponse(detection: CrisisDetection): Promise<void> {\n  const escalationSteps = [\n    { delay: 0, action: () => notifyPrimaryOnCall(detection) },\n    { delay: 5 * 60 * 1000, action: () => notifyBackupOnCall(detection) },\n    { delay: 10 * 60 * 1000, action: () => notifySupervisor(detection) },\n    { delay: 15 * 60 * 1000, action: () => showEmergencyModal(detection.userId) }\n  ];\n\n  for (const step of escalationSteps) {\n    setTimeout(async () => {\n      const responded = await checkResponse(detection.id);\n      if (!responded) {\n        await step.action();\n      }\n    }, step.delay);\n  }\n}\n```\n\n---\n\n## Documentation Requirements\n\n**For every crisis intervention**:\n\n1. **Detection Record**:\n   - Timestamp\n   - Detected signals\n   - Severity level\n   - Confidence score\n\n2. **Action Log**:\n   - Resources shown\n   - Who was notified\n   - When they responded\n   - What actions were taken\n\n3. **Outcome**:\n   - User status after intervention\n   - Follow-up scheduled?\n   - Escalation needed?\n\n4. **Compliance**:\n   - Access logged (who viewed crisis content)\n   - Auto-delete scheduled (30 days)\n   - Encryption verified\n\n**Sample Documentation**:\n```json\n{\n  \"detection_id\": \"crisis-123\",\n  \"user_id\": \"user-456\",\n  \"detected_at\": \"2024-01-15T14:32:00Z\",\n  \"severity\": \"high\",\n  \"signals\": [\"suicidal_ideation\"],\n  \"confidence\": 0.92,\n  \"actions_taken\": [\n    {\n      \"action\": \"988_modal_shown\",\n      \"timestamp\": \"2024-01-15T14:32:01Z\"\n    },\n    {\n      \"action\": \"on_call_notified\",\n      \"timestamp\": \"2024-01-15T14:32:02Z\",\n      \"counselor_id\": \"counselor-789\"\n    },\n    {\n      \"action\": \"counselor_responded\",\n      \"timestamp\": \"2024-01-15T14:34:15Z\",\n      \"response_time_seconds\": 133\n    }\n  ],\n  \"outcome\": {\n    \"user_safe\": true,\n    \"follow_up_scheduled\": \"2024-01-16T10:00:00Z\",\n    \"notes\": \"User connected with counselor, safety plan created\"\n  },\n  \"auto_delete_at\": \"2024-02-14T14:32:00Z\"\n}\n```\n\n---\n\n## Training Materials\n\n**For crisis counselors**:\n\n1. **Understanding AI Detection**:\n   - How the system works (multi-signal detection)\n   - What triggers each severity level\n   - False positive handling\n\n2. **Response Protocols**:\n   - Scripts for each severity level\n   - Escalation procedures\n   - Documentation requirements\n\n3. **Crisis Resources**:\n   - 988 Suicide & Crisis Lifeline\n   - Crisis Text Line (741741)\n   - SAMHSA National Helpline (1-800-662-4357)\n   - Local emergency resources\n\n4. **Self-Care**:\n   - Secondary trauma awareness\n   - Counselor support resources\n   - Burnout prevention\n\n---\n\n## Quality Assurance\n\n**Regular review**:\n- ‚úÖ Weekly: Review all immediate/high severity interventions\n- ‚úÖ Monthly: Analyze false positive/negative rates\n- ‚úÖ Quarterly: Update keyword patterns based on missed cases\n- ‚úÖ Annually: Full protocol review with clinical team\n\n**Metrics to track**:\n- Response time (goal: &lt;5 min for immediate)\n- False positive rate (goal: &lt;10%)\n- False negative rate (goal: &lt;5%)\n- User outcome (did intervention help?)\n- Counselor satisfaction\n\n---\n\n## Legal & Ethical Considerations\n\n**Informed Consent**:\n- Users must consent to crisis monitoring\n- Clear explanation of how detection works\n- Opt-out option (with strong warning)\n\n**Mandatory Reporting**:\n- Imminent danger to self: Report to emergency services\n- Imminent danger to others: Report to authorities\n- Child abuse: Report to authorities (per jurisdiction)\n\n**Confidentiality**:\n- Crisis content is PHI (HIPAA applies)\n- Only licensed professionals can access\n- Access is logged and audited\n- Auto-deleted after retention period\n\n**Liability**:\n- AI is assistive tool, not replacement for professional judgment\n- Counselors make final decisions\n- Clear disclaimers in app\n- Professional liability insurance required\n\n---\n\n## Resources\n\n- [988 Suicide & Crisis Lifeline](https://988lifeline.org/)\n- [Crisis Text Line](https://www.crisistextline.org/)\n- [SAMHSA Treatment Locator](https://findtreatment.samhsa.gov/)\n- [National Alliance on Mental Illness](https://www.nami.org/)\n"
        },
        {
          "name": "mental-health-nlp.md",
          "type": "file",
          "path": "crisis-detection-intervention-ai/references/mental-health-nlp.md",
          "size": 3954,
          "content": "# Mental Health NLP Models\n\nComprehensive guide to NLP models for mental health crisis detection.\n\n## Model Comparison (2024)\n\n| Model | Accuracy | Latency | Use Case | License |\n|-------|----------|---------|----------|---------|\n| [Mental-BERT](https://huggingface.co/mental/mental-bert-base-uncased) | 89% | 50ms | Depression, anxiety detection | MIT |\n| [MentalRoBERTa](https://huggingface.co/mental/mental-roberta-base) | 87% | 40ms | Suicidal ideation | MIT |\n| GPT-4 (few-shot) | 92% | 200ms | General crisis detection | Commercial |\n| Claude 3.5 Sonnet | 91% | 150ms | Contextual analysis | Commercial |\n| Custom fine-tuned BERT | 90%+ | 60ms | Domain-specific (e.g., addiction) | Depends |\n\n---\n\n## Using Mental-BERT\n\n### Installation\n\n```bash\nnpm install @huggingface/transformers\n```\n\n### Classification\n\n```typescript\nimport { pipeline } from '@huggingface/transformers';\n\nconst detector = await pipeline(\n  'text-classification',\n  'mental/mental-bert-base-uncased'\n);\n\nconst result = await detector(\"I don't want to live anymore\", {\n  top_k: 3\n});\n\nconsole.log(result);\n// [\n//   { label: 'suicidal_ideation', score: 0.92 },\n//   { label: 'severe_depression', score: 0.78 },\n//   { label: 'self_harm', score: 0.45 }\n// ]\n```\n\n---\n\n## Fine-Tuning for Your Domain\n\n### Dataset Format\n\n```json\n[\n  {\n    \"text\": \"I relapsed today after 6 months sober\",\n    \"label\": \"substance_relapse\",\n    \"severity\": \"medium\"\n  },\n  {\n    \"text\": \"I can't do this anymore, I want to end it\",\n    \"label\": \"suicidal_ideation\",\n    \"severity\": \"high\"\n  },\n  {\n    \"text\": \"Had a stressful day at work\",\n    \"label\": \"normal_distress\",\n    \"severity\": \"none\"\n  }\n]\n```\n\n### Training Script\n\n```python\nfrom transformers import AutoModelForSequenceClassification, Trainer, TrainingArguments\nfrom datasets import load_dataset\n\n# Load pre-trained model\nmodel = AutoModelForSequenceClassification.from_pretrained(\n    \"mental/mental-bert-base-uncased\",\n    num_labels=4  # suicidal, self_harm, relapse, safe\n)\n\n# Load your dataset\ndataset = load_dataset('json', data_files='crisis_training_data.json')\n\n# Training arguments\ntraining_args = TrainingArguments(\n    output_dir=\"./crisis-model\",\n    num_train_epochs=3,\n    per_device_train_batch_size=16,\n    per_device_eval_batch_size=64,\n    eval_strategy=\"epoch\",\n    save_strategy=\"epoch\",\n    load_best_model_at_end=True\n)\n\n# Train\ntrainer = Trainer(\n    model=model,\n    args=training_args,\n    train_dataset=dataset['train'],\n    eval_dataset=dataset['test']\n)\n\ntrainer.train()\n```\n\n---\n\n## Evaluation Metrics\n\n### Confusion Matrix\n\n```\n                Predicted\n              Crisis  Safe\nActual Crisis   92     8    (Recall: 92%)\n       Safe      5    95    (Precision: 95%)\n```\n\n**Key Metrics**:\n- **Recall** (Sensitivity): 92% - How many actual crises are detected\n- **Precision**: 95% - How many detections are actual crises\n- **F1 Score**: 93.5% - Harmonic mean\n\n**Which matters more?**\n- Crisis detection: Maximize recall (don't miss crises, accept false positives)\n- Spam detection: Maximize precision (avoid false alarms)\n\n---\n\n## Production Deployment\n\n### Caching for Performance\n\n```typescript\nimport { pipeline } from '@huggingface/transformers';\n\nclass CachedDetector {\n  private model: any;\n  private cache = new Map<string, any>();\n\n  async init() {\n    this.model = await pipeline(\n      'text-classification',\n      'mental/mental-bert-base-uncased'\n    );\n  }\n\n  async detect(text: string): Promise<any> {\n    // Cache by hash\n    const hash = hashText(text);\n\n    if (this.cache.has(hash)) {\n      return this.cache.get(hash);\n    }\n\n    const result = await this.model(text);\n    this.cache.set(hash, result);\n\n    return result;\n  }\n}\n```\n\n---\n\n## Resources\n\n- [Mental Health NLP Dataset](https://huggingface.co/datasets/mental_health)\n- [Transformers.js Docs](https://huggingface.co/docs/transformers.js)\n- [Crisis Detection Papers](https://arxiv.org/search/?query=suicide+detection+nlp)\n"
        }
      ]
    },
    {
      "name": "scripts",
      "type": "folder",
      "path": "crisis-detection-intervention-ai/scripts",
      "children": [
        {
          "name": "crisis_detector.ts",
          "type": "file",
          "path": "crisis-detection-intervention-ai/scripts/crisis_detector.ts",
          "size": 10988,
          "content": "#!/usr/bin/env node\n/**\n * Crisis Detection System\n *\n * Real-time mental health crisis detection using multiple signals.\n *\n * Usage: npx tsx crisis_detector.ts [text]\n *\n * Examples:\n *   npx tsx crisis_detector.ts \"I don't want to be here anymore\"\n *   npx tsx crisis_detector.ts \"Had a tough day at work\"\n *\n * Signals:\n *   - NLP model classification\n *   - Keyword pattern matching\n *   - Sentiment + context analysis\n */\n\ninterface CrisisSignal {\n  type: 'suicidal_ideation' | 'self_harm' | 'substance_relapse' | 'severe_distress';\n  confidence: number;\n  evidence: string[];\n  source: 'nlp' | 'keywords' | 'sentiment' | 'context';\n}\n\ninterface CrisisDetection {\n  isCrisis: boolean;\n  severity: 'none' | 'low' | 'medium' | 'high' | 'immediate';\n  signals: CrisisSignal[];\n  confidence: number;\n  recommendations: string[];\n}\n\n// Crisis keywords (evidence-based patterns)\nconst CRISIS_PATTERNS = {\n  suicidal_ideation: [\n    /\\b(kill|end|take)\\s+(my|own)\\s+life\\b/i,\n    /\\bsuicide\\b/i,\n    /\\bdon'?t\\s+want\\s+to\\s+(live|be here|exist)\\b/i,\n    /\\bbetter off dead\\b/i,\n    /\\bno\\s+reason\\s+to\\s+(live|continue|go on)\\b/i,\n    /\\bcan'?t\\s+(take|do)\\s+this\\s+anymore\\b/i\n  ],\n  self_harm: [\n    /\\b(cut|cutting|hurt|hurting)\\s+(myself|me)\\b/i,\n    /\\bself[- ]harm\\b/i,\n    /\\bburning\\s+myself\\b/i\n  ],\n  substance_relapse: [\n    /\\b(relapsed|used|drank)\\s+(again|today|yesterday)\\b/i,\n    /\\bback on\\s+(drugs|alcohol|using)\\b/i,\n    /\\bcouldn'?t\\s+stay\\s+sober\\b/i,\n    /\\b(cravings?|urges?)\\s+(are\\s+)?too\\s+strong\\b/i\n  ],\n  hopelessness: [\n    /\\bno\\s+(hope|point|reason|future)\\b/i,\n    /\\bnothing\\s+(matters|helps|works)\\b/i,\n    /\\bcan'?t\\s+see\\s+a\\s+way\\s+out\\b/i,\n    /\\ball\\s+alone\\b/i,\n    /\\bnobody\\s+(cares|understands)\\b/i\n  ]\n};\n\n// Protective factors (reduce crisis severity)\nconst PROTECTIVE_PATTERNS = [\n  /\\b(therapist|counselor|support\\s+group)\\b/i,\n  /\\b(reaching\\s+out|asking\\s+for\\s+help)\\b/i,\n  /\\b(called|talked\\s+to)\\s+(friend|family|sponsor)\\b/i,\n  /\\bsafety\\s+plan\\b/i\n];\n\nclass CrisisDetector {\n  /**\n   * Detect crisis signals in text\n   */\n  detect(text: string): CrisisDetection {\n    const signals: CrisisSignal[] = [];\n\n    // Signal 1: Keyword matching\n    const keywordSignals = this.detectKeywords(text);\n    signals.push(...keywordSignals);\n\n    // Signal 2: Sentiment analysis (simplified)\n    const sentimentSignal = this.analyzeSentiment(text);\n    if (sentimentSignal) {\n      signals.push(sentimentSignal);\n    }\n\n    // Signal 3: Context analysis\n    const contextSignal = this.analyzeContext(text);\n    if (contextSignal) {\n      signals.push(contextSignal);\n    }\n\n    // Check for protective factors\n    const hasProtection = this.hasProtectiveFactors(text);\n\n    // Calculate overall severity\n    const severity = this.calculateSeverity(signals, hasProtection);\n    const confidence = this.calculateConfidence(signals);\n\n    // Generate recommendations\n    const recommendations = this.generateRecommendations(severity, signals);\n\n    return {\n      isCrisis: severity !== 'none',\n      severity,\n      signals,\n      confidence,\n      recommendations\n    };\n  }\n\n  private detectKeywords(text: string): CrisisSignal[] {\n    const signals: CrisisSignal[] = [];\n\n    for (const [type, patterns] of Object.entries(CRISIS_PATTERNS)) {\n      const matches: string[] = [];\n\n      for (const pattern of patterns) {\n        const match = text.match(pattern);\n        if (match) {\n          matches.push(match[0]);\n        }\n      }\n\n      if (matches.length > 0) {\n        signals.push({\n          type: type as CrisisSignal['type'],\n          confidence: Math.min(0.6 + (matches.length * 0.1), 0.9),\n          evidence: matches,\n          source: 'keywords'\n        });\n      }\n    }\n\n    return signals;\n  }\n\n  private analyzeSentiment(text: string): CrisisSignal | null {\n    // Simplified sentiment analysis\n    const negativeWords = ['hate', 'pain', 'hurt', 'sad', 'miserable', 'awful', 'terrible'];\n    const negativeCount = negativeWords.filter(word =>\n      new RegExp(`\\\\b${word}\\\\b`, 'i').test(text)\n    ).length;\n\n    const totalWords = text.split(/\\s+/).length;\n    const negativeRatio = negativeCount / totalWords;\n\n    if (negativeRatio > 0.2) {\n      return {\n        type: 'severe_distress',\n        confidence: Math.min(negativeRatio * 3, 0.8),\n        evidence: [`High negative sentiment: ${(negativeRatio * 100).toFixed(1)}%`],\n        source: 'sentiment'\n      };\n    }\n\n    return null;\n  }\n\n  private analyzeContext(text: string): CrisisSignal | null {\n    // Check for hopelessness + negative sentiment\n    const hasHopelessness = CRISIS_PATTERNS.hopelessness.some(pattern =>\n      pattern.test(text)\n    );\n\n    const hasNegativeFuture = /\\b(never|won'?t|can'?t)\\s+(get|be)\\s+better\\b/i.test(text);\n\n    if (hasHopelessness && hasNegativeFuture) {\n      return {\n        type: 'severe_distress',\n        confidence: 0.75,\n        evidence: ['Hopelessness + negative future outlook'],\n        source: 'context'\n      };\n    }\n\n    return null;\n  }\n\n  private hasProtectiveFactors(text: string): boolean {\n    return PROTECTIVE_PATTERNS.some(pattern => pattern.test(text));\n  }\n\n  private calculateSeverity(\n    signals: CrisisSignal[],\n    hasProtection: boolean\n  ): CrisisDetection['severity'] {\n    if (signals.length === 0) {\n      return 'none';\n    }\n\n    // Check for high-risk signals\n    const hasSuicidalIdeation = signals.some(s =>\n      s.type === 'suicidal_ideation' && s.confidence > 0.7\n    );\n\n    const hasSelfHarm = signals.some(s =>\n      s.type === 'self_harm' && s.confidence > 0.6\n    );\n\n    const maxConfidence = Math.max(...signals.map(s => s.confidence));\n\n    if (hasSuicidalIdeation && !hasProtection) {\n      return maxConfidence > 0.85 ? 'immediate' : 'high';\n    }\n\n    if (hasSelfHarm || hasSuicidalIdeation) {\n      return 'high';\n    }\n\n    if (signals.some(s => s.type === 'substance_relapse')) {\n      return 'medium';\n    }\n\n    if (signals.some(s => s.type === 'severe_distress')) {\n      return hasProtection ? 'low' : 'medium';\n    }\n\n    return 'low';\n  }\n\n  private calculateConfidence(signals: CrisisSignal[]): number {\n    if (signals.length === 0) return 0;\n\n    // Average confidence across all signals\n    const avgConfidence = signals.reduce((sum, s) => sum + s.confidence, 0) / signals.length;\n\n    // Boost confidence if multiple signals agree\n    const uniqueTypes = new Set(signals.map(s => s.type));\n    const agreementBoost = signals.length > 1 ? 0.1 : 0;\n\n    return Math.min(avgConfidence + agreementBoost, 1.0);\n  }\n\n  private generateRecommendations(\n    severity: CrisisDetection['severity'],\n    signals: CrisisSignal[]\n  ): string[] {\n    const recommendations: string[] = [];\n\n    switch (severity) {\n      case 'immediate':\n      case 'high':\n        recommendations.push('IMMEDIATE: Show 988 Suicide & Crisis Lifeline modal');\n        recommendations.push('IMMEDIATE: Notify on-call crisis counselor');\n        recommendations.push('IMMEDIATE: Log for urgent review');\n        recommendations.push('Provide Crisis Text Line: 741741');\n        break;\n\n      case 'medium':\n        recommendations.push('Show crisis resources in-app');\n        recommendations.push('Flag for counselor review within 24 hours');\n        recommendations.push('Suggest self-help coping strategies');\n        break;\n\n      case 'low':\n        recommendations.push('Add to review queue (normal priority)');\n        recommendations.push('Offer supportive resources');\n        break;\n\n      case 'none':\n        recommendations.push('No action needed');\n        break;\n    }\n\n    // Add signal-specific recommendations\n    if (signals.some(s => s.type === 'substance_relapse')) {\n      recommendations.push('Connect user to sponsor contact');\n      recommendations.push('Suggest attending a meeting');\n    }\n\n    if (signals.some(s => s.type === 'self_harm')) {\n      recommendations.push('Provide grounding techniques');\n      recommendations.push('Suggest harm reduction resources');\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Format detection result for display\n   */\n  format(detection: CrisisDetection): string {\n    const severityEmoji = {\n      none: '‚úÖ',\n      low: 'üíõ',\n      medium: 'üü†',\n      high: 'üî¥',\n      immediate: 'üö®'\n    };\n\n    let output = `\\n${severityEmoji[detection.severity]} Crisis Detection Result\\n\\n`;\n    output += `Severity: ${detection.severity.toUpperCase()}\\n`;\n    output += `Confidence: ${(detection.confidence * 100).toFixed(1)}%\\n`;\n    output += `Is Crisis: ${detection.isCrisis ? 'YES' : 'NO'}\\n\\n`;\n\n    if (detection.signals.length > 0) {\n      output += 'Detected Signals:\\n';\n      detection.signals.forEach(signal => {\n        output += `\\n  ‚Ä¢ ${signal.type.replace(/_/g, ' ').toUpperCase()}\\n`;\n        output += `    Confidence: ${(signal.confidence * 100).toFixed(1)}%\\n`;\n        output += `    Source: ${signal.source}\\n`;\n        output += `    Evidence: ${signal.evidence.join(', ')}\\n`;\n      });\n    }\n\n    output += '\\n‚îÄ'.repeat(80) + '\\n';\n    output += '\\nRecommended Actions:\\n';\n    detection.recommendations.forEach(rec => {\n      output += `\\n  ${rec}`;\n    });\n\n    output += '\\n\\nüîí Privacy Note: All crisis detections must be:\\n';\n    output += '  ‚Ä¢ Stored encrypted\\n';\n    output += '  ‚Ä¢ Access-logged\\n';\n    output += '  ‚Ä¢ Auto-deleted after 30 days\\n';\n    output += '  ‚Ä¢ Reviewed by licensed professionals only\\n';\n\n    output += '\\n';\n    return output;\n  }\n}\n\n// CLI entry point\nif (require.main === module) {\n  const args = process.argv.slice(2);\n\n  if (args.length === 0) {\n    console.log('Usage: npx tsx crisis_detector.ts [text]');\n    console.log('\\nExamples:');\n    console.log('  npx tsx crisis_detector.ts \"I don\\'t want to be here anymore\"');\n    console.log('  npx tsx crisis_detector.ts \"Had a tough day at work\"');\n    console.log('  npx tsx crisis_detector.ts \"I relapsed today, feeling awful\"');\n    console.log('\\n‚ö†Ô∏è  This is a detection tool, NOT a substitute for professional help.');\n    console.log('Always consult licensed mental health professionals.');\n    process.exit(1);\n  }\n\n  const text = args.join(' ');\n\n  console.log('\\nüìù Analyzing text:');\n  console.log(`\"${text}\"\\n`);\n\n  const detector = new CrisisDetector();\n  const result = detector.detect(text);\n\n  console.log(detector.format(result));\n\n  // Show crisis resources for any detected crisis\n  if (result.isCrisis) {\n    console.log('‚ïê'.repeat(80));\n    console.log('\\nüÜò CRISIS RESOURCES AVAILABLE 24/7:\\n');\n    console.log('  ‚Ä¢ 988 Suicide & Crisis Lifeline');\n    console.log('    Phone: 988');\n    console.log('    Chat: https://988lifeline.org/chat');\n    console.log('\\n  ‚Ä¢ Crisis Text Line');\n    console.log('    Text \"HELLO\" to 741741');\n    console.log('\\n  ‚Ä¢ SAMHSA National Helpline (Substance Abuse)');\n    console.log('    Phone: 1-800-662-4357');\n    console.log('\\n‚ïê'.repeat(80) + '\\n');\n  }\n}\n\nexport { CrisisDetector, CrisisDetection, CrisisSignal };\n"
        },
        {
          "name": "model_evaluator.ts",
          "type": "file",
          "path": "crisis-detection-intervention-ai/scripts/model_evaluator.ts",
          "size": 13243,
          "content": "#!/usr/bin/env node\n/**\n * Crisis Detection Model Evaluator\n *\n * Evaluates crisis detection accuracy using test cases with ground truth labels.\n *\n * Usage: npx tsx model_evaluator.ts [test-cases.json]\n *\n * Test Case Format:\n * [\n *   {\n *     \"text\": \"I don't want to be here anymore\",\n *     \"expected_severity\": \"high\",\n *     \"expected_signals\": [\"suicidal_ideation\"]\n *   }\n * ]\n *\n * Metrics:\n *   - Precision: Of all detected crises, how many were actual crises?\n *   - Recall: Of all actual crises, how many did we detect?\n *   - F1 Score: Harmonic mean of precision and recall\n *   - Confusion Matrix: True/false positives/negatives\n */\n\nimport { CrisisDetector, CrisisDetection, CrisisSignal } from './crisis_detector';\nimport * as fs from 'fs';\n\ninterface TestCase {\n  text: string;\n  expected_severity: 'none' | 'low' | 'medium' | 'high' | 'immediate';\n  expected_signals: string[];\n  description?: string;\n}\n\ninterface EvaluationResult {\n  testCase: TestCase;\n  detection: CrisisDetection;\n  severityMatch: boolean;\n  signalsMatch: boolean;\n  truePositive: boolean;\n  falsePositive: boolean;\n  trueNegative: boolean;\n  falseNegative: boolean;\n}\n\ninterface Metrics {\n  accuracy: number;\n  precision: number;\n  recall: number;\n  f1Score: number;\n  confusionMatrix: {\n    truePositives: number;\n    falsePositives: number;\n    trueNegatives: number;\n    falseNegatives: number;\n  };\n  severityAccuracy: number;\n  signalAccuracy: number;\n}\n\nclass ModelEvaluator {\n  private detector: CrisisDetector;\n\n  constructor() {\n    this.detector = new CrisisDetector();\n  }\n\n  /**\n   * Load test cases from JSON file\n   */\n  loadTestCases(filePath: string): TestCase[] {\n    const content = fs.readFileSync(filePath, 'utf-8');\n    return JSON.parse(content);\n  }\n\n  /**\n   * Evaluate model on test cases\n   */\n  evaluate(testCases: TestCase[]): EvaluationResult[] {\n    const results: EvaluationResult[] = [];\n\n    for (const testCase of testCases) {\n      const detection = this.detector.detect(testCase.text);\n\n      const severityMatch = detection.severity === testCase.expected_severity;\n\n      // Check if detected signals match expected signals\n      const detectedTypes = new Set(detection.signals.map(s => s.type));\n      const expectedTypes = new Set(testCase.expected_signals);\n      const signalsMatch = this.setsEqual(detectedTypes, expectedTypes);\n\n      // Classify result for confusion matrix\n      const actualCrisis = testCase.expected_severity !== 'none';\n      const detectedCrisis = detection.isCrisis;\n\n      const truePositive = actualCrisis && detectedCrisis;\n      const falsePositive = !actualCrisis && detectedCrisis;\n      const trueNegative = !actualCrisis && !detectedCrisis;\n      const falseNegative = actualCrisis && !detectedCrisis;\n\n      results.push({\n        testCase,\n        detection,\n        severityMatch,\n        signalsMatch,\n        truePositive,\n        falsePositive,\n        trueNegative,\n        falseNegative\n      });\n    }\n\n    return results;\n  }\n\n  /**\n   * Calculate metrics from evaluation results\n   */\n  calculateMetrics(results: EvaluationResult[]): Metrics {\n    const tp = results.filter(r => r.truePositive).length;\n    const fp = results.filter(r => r.falsePositive).length;\n    const tn = results.filter(r => r.trueNegative).length;\n    const fn = results.filter(r => r.falseNegative).length;\n\n    const accuracy = (tp + tn) / results.length;\n    const precision = tp > 0 ? tp / (tp + fp) : 0;\n    const recall = tp > 0 ? tp / (tp + fn) : 0;\n    const f1Score = precision + recall > 0\n      ? 2 * (precision * recall) / (precision + recall)\n      : 0;\n\n    const severityMatches = results.filter(r => r.severityMatch).length;\n    const severityAccuracy = severityMatches / results.length;\n\n    const signalMatches = results.filter(r => r.signalsMatch).length;\n    const signalAccuracy = signalMatches / results.length;\n\n    return {\n      accuracy,\n      precision,\n      recall,\n      f1Score,\n      confusionMatrix: {\n        truePositives: tp,\n        falsePositives: fp,\n        trueNegatives: tn,\n        falseNegatives: fn\n      },\n      severityAccuracy,\n      signalAccuracy\n    };\n  }\n\n  /**\n   * Generate evaluation report\n   */\n  generateReport(results: EvaluationResult[], metrics: Metrics): string {\n    let report = '\\nüìä Crisis Detection Model Evaluation\\n';\n    report += '‚ïê'.repeat(80) + '\\n\\n';\n\n    // Overall Metrics\n    report += '## Overall Metrics\\n\\n';\n    report += `Accuracy:  ${(metrics.accuracy * 100).toFixed(1)}%\\n`;\n    report += `Precision: ${(metrics.precision * 100).toFixed(1)}%\\n`;\n    report += `Recall:    ${(metrics.recall * 100).toFixed(1)}%\\n`;\n    report += `F1 Score:  ${(metrics.f1Score * 100).toFixed(1)}%\\n\\n`;\n\n    // Confusion Matrix\n    report += '## Confusion Matrix\\n\\n';\n    report += '                Predicted\\n';\n    report += '              Crisis  Safe\\n';\n    report += `Actual Crisis   ${metrics.confusionMatrix.truePositives.toString().padStart(3)}    ${metrics.confusionMatrix.falseNegatives.toString().padStart(3)}\\n`;\n    report += `       Safe     ${metrics.confusionMatrix.falsePositives.toString().padStart(3)}    ${metrics.confusionMatrix.trueNegatives.toString().padStart(3)}\\n\\n`;\n\n    // Detailed Metrics\n    report += '## Detailed Metrics\\n\\n';\n    report += `Severity Accuracy: ${(metrics.severityAccuracy * 100).toFixed(1)}%\\n`;\n    report += `Signal Accuracy:   ${(metrics.signalAccuracy * 100).toFixed(1)}%\\n\\n`;\n\n    // False Negatives (Most Critical)\n    report += '## ‚ö†Ô∏è  False Negatives (Missed Crises)\\n\\n';\n    const falseNegatives = results.filter(r => r.falseNegative);\n    if (falseNegatives.length > 0) {\n      falseNegatives.forEach((result, i) => {\n        report += `${i + 1}. \"${result.testCase.text}\"\\n`;\n        report += `   Expected: ${result.testCase.expected_severity} | Detected: ${result.detection.severity}\\n`;\n        report += `   Expected Signals: ${result.testCase.expected_signals.join(', ')}\\n`;\n        report += `   Detected Signals: ${result.detection.signals.map(s => s.type).join(', ') || 'none'}\\n\\n`;\n      });\n    } else {\n      report += 'None ‚úÖ\\n\\n';\n    }\n\n    // False Positives\n    report += '## üö® False Positives (False Alarms)\\n\\n';\n    const falsePositives = results.filter(r => r.falsePositive);\n    if (falsePositives.length > 0) {\n      falsePositives.forEach((result, i) => {\n        report += `${i + 1}. \"${result.testCase.text}\"\\n`;\n        report += `   Expected: ${result.testCase.expected_severity} | Detected: ${result.detection.severity}\\n`;\n        report += `   Confidence: ${(result.detection.confidence * 100).toFixed(1)}%\\n\\n`;\n      });\n    } else {\n      report += 'None ‚úÖ\\n\\n';\n    }\n\n    // Severity Breakdown\n    report += '## Severity Level Performance\\n\\n';\n    const severityLevels: Array<'none' | 'low' | 'medium' | 'high' | 'immediate'> =\n      ['none', 'low', 'medium', 'high', 'immediate'];\n\n    severityLevels.forEach(level => {\n      const casesAtLevel = results.filter(r => r.testCase.expected_severity === level);\n      if (casesAtLevel.length > 0) {\n        const correctAtLevel = casesAtLevel.filter(r => r.severityMatch).length;\n        const accuracy = (correctAtLevel / casesAtLevel.length * 100).toFixed(1);\n        report += `${level.toUpperCase().padEnd(10)} ${correctAtLevel}/${casesAtLevel.length} (${accuracy}%)\\n`;\n      }\n    });\n\n    report += '\\n';\n\n    // Recommendations\n    report += '## üí° Recommendations\\n\\n';\n\n    if (metrics.recall < 0.9) {\n      report += '‚Ä¢ ‚ö†Ô∏è  CRITICAL: Recall is below 90%. Missing real crises.\\n';\n      report += '  ‚Üí Lower detection threshold or add more keyword patterns\\n\\n';\n    }\n\n    if (metrics.precision < 0.7) {\n      report += '‚Ä¢ False positive rate is high (>30%)\\n';\n      report += '  ‚Üí Increase confidence threshold or refine keyword patterns\\n\\n';\n    }\n\n    if (falseNegatives.length > 0) {\n      report += `‚Ä¢ Review ${falseNegatives.length} false negative(s) and add missing patterns\\n\\n`;\n    }\n\n    if (metrics.severityAccuracy < 0.8) {\n      report += '‚Ä¢ Severity classification needs improvement\\n';\n      report += '  ‚Üí Review severity calculation logic\\n\\n';\n    }\n\n    return report;\n  }\n\n  /**\n   * Helper: Check if two sets are equal\n   */\n  private setsEqual<T>(set1: Set<T>, set2: Set<T>): boolean {\n    if (set1.size !== set2.size) return false;\n    for (const item of set1) {\n      if (!set2.has(item)) return false;\n    }\n    return true;\n  }\n\n  /**\n   * Export results to JSON\n   */\n  exportResults(results: EvaluationResult[], outputPath: string): void {\n    const output = {\n      timestamp: new Date().toISOString(),\n      total_cases: results.length,\n      results: results.map(r => ({\n        text: r.testCase.text,\n        expected: {\n          severity: r.testCase.expected_severity,\n          signals: r.testCase.expected_signals\n        },\n        detected: {\n          severity: r.detection.severity,\n          signals: r.detection.signals.map(s => s.type),\n          confidence: r.detection.confidence\n        },\n        correct: r.severityMatch && r.signalsMatch\n      }))\n    };\n\n    fs.writeFileSync(outputPath, JSON.stringify(output, null, 2));\n    console.log(`\\n‚úÖ Results exported to ${outputPath}`);\n  }\n}\n\n// Default test cases\nconst DEFAULT_TEST_CASES: TestCase[] = [\n  // Suicidal ideation - high severity\n  {\n    text: \"I don't want to be here anymore\",\n    expected_severity: 'high',\n    expected_signals: ['suicidal_ideation'],\n    description: 'Clear suicidal ideation'\n  },\n  {\n    text: \"I'm thinking about ending it all\",\n    expected_severity: 'high',\n    expected_signals: ['suicidal_ideation'],\n    description: 'Explicit suicidal thoughts'\n  },\n  {\n    text: \"Everyone would be better off without me\",\n    expected_severity: 'high',\n    expected_signals: ['suicidal_ideation'],\n    description: 'Suicidal ideation with perceived burden'\n  },\n\n  // Self-harm\n  {\n    text: \"I cut myself last night\",\n    expected_severity: 'high',\n    expected_signals: ['self_harm'],\n    description: 'Self-harm disclosure'\n  },\n\n  // Substance relapse\n  {\n    text: \"I relapsed today after 6 months sober\",\n    expected_severity: 'medium',\n    expected_signals: ['substance_relapse'],\n    description: 'Substance relapse'\n  },\n  {\n    text: \"The cravings are too strong, I can't resist\",\n    expected_severity: 'medium',\n    expected_signals: ['substance_relapse'],\n    description: 'Strong cravings indicating risk'\n  },\n\n  // Severe distress (no specific crisis)\n  {\n    text: \"I feel so hopeless and alone, nothing matters anymore\",\n    expected_severity: 'medium',\n    expected_signals: ['severe_distress'],\n    description: 'Severe distress with hopelessness'\n  },\n\n  // Normal distress - should NOT trigger crisis\n  {\n    text: \"Had a tough day at work, feeling stressed\",\n    expected_severity: 'none',\n    expected_signals: [],\n    description: 'Normal work stress'\n  },\n  {\n    text: \"Feeling a bit down today\",\n    expected_severity: 'none',\n    expected_signals: [],\n    description: 'Mild sadness'\n  },\n  {\n    text: \"I'm tired of this project, it's taking forever\",\n    expected_severity: 'none',\n    expected_signals: [],\n    description: 'Frustration (not crisis)'\n  },\n\n  // Edge cases\n  {\n    text: \"I want to kill this bug in my code\",\n    expected_severity: 'none',\n    expected_signals: [],\n    description: 'False positive test: coding language'\n  },\n  {\n    text: \"This movie is killing me, so funny!\",\n    expected_severity: 'none',\n    expected_signals: [],\n    description: 'False positive test: figurative language'\n  },\n\n  // With protective factors\n  {\n    text: \"Having dark thoughts but I called my therapist and have a safety plan\",\n    expected_severity: 'low',\n    expected_signals: ['severe_distress'],\n    description: 'Crisis with protective factors'\n  }\n];\n\n// CLI entry point\nif (require.main === module) {\n  const args = process.argv.slice(2);\n\n  let testCases: TestCase[];\n  const evaluator = new ModelEvaluator();\n\n  if (args.length > 0) {\n    // Load test cases from file\n    const filePath = args[0];\n    console.log(`\\nüìÇ Loading test cases from ${filePath}...`);\n    testCases = evaluator.loadTestCases(filePath);\n  } else {\n    // Use default test cases\n    console.log('\\nüìù Using default test cases...');\n    testCases = DEFAULT_TEST_CASES;\n  }\n\n  console.log(`\\nüß™ Evaluating model on ${testCases.length} test cases...\\n`);\n\n  // Run evaluation\n  const results = evaluator.evaluate(testCases);\n  const metrics = evaluator.calculateMetrics(results);\n\n  // Generate and display report\n  const report = evaluator.generateReport(results, metrics);\n  console.log(report);\n\n  // Export results if requested\n  if (args.includes('--export')) {\n    const outputPath = args.includes('--output')\n      ? args[args.indexOf('--output') + 1]\n      : 'evaluation-results.json';\n    evaluator.exportResults(results, outputPath);\n  }\n\n  // Exit with error code if recall is too low (missing real crises)\n  if (metrics.recall < 0.9) {\n    console.log('‚ùå CRITICAL: Recall below 90%. Model is missing real crises.\\n');\n    process.exit(1);\n  }\n\n  console.log('‚úÖ Evaluation complete.\\n');\n}\n\nexport { ModelEvaluator, TestCase, EvaluationResult, Metrics };\n"
        }
      ]
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "crisis-detection-intervention-ai/SKILL.md",
      "size": 14788,
      "content": "---\nname: crisis-detection-intervention-ai\ndescription: Detect crisis signals in user content using NLP, mental health sentiment analysis, and safe intervention protocols. Implements suicide ideation detection, automated escalation, and crisis resource integration. Use for mental health apps, recovery platforms, support communities. Activate on \"crisis detection\", \"suicide prevention\", \"mental health NLP\", \"intervention protocol\". NOT for general sentiment analysis, medical diagnosis, or replacing professional help.\nallowed-tools: Read,Write,Edit,Bash(npm:*)\n---\n\n# Crisis Detection & Intervention AI\n\nExpert in detecting mental health crises and implementing safe, ethical intervention protocols.\n\n## ‚ö†Ô∏è ETHICAL DISCLAIMER\n\n**This skill assists with crisis detection, NOT crisis response**.\n\n‚úÖ **Appropriate uses**:\n- Flagging concerning content for human review\n- Connecting users to professional resources\n- Escalating to crisis counselors\n- Providing immediate hotline information\n\n‚ùå **NOT a substitute for**:\n- Licensed therapists\n- Emergency services (911)\n- Medical diagnosis\n- Professional mental health treatment\n\n**Always provide crisis hotlines**: National Suicide Prevention Lifeline: 988\n\n---\n\n## When to Use\n\n‚úÖ **Use for**:\n- Mental health journaling apps\n- Recovery community platforms\n- Support group monitoring\n- Online therapy platforms\n- Crisis text line integration\n\n‚ùå **NOT for**:\n- General sentiment analysis (use standard tools)\n- Medical diagnosis (not qualified)\n- Automated responses without human review\n- Replacing professional crisis counselors\n\n## Quick Decision Tree\n\n```\nDetected concerning content?\n‚îú‚îÄ‚îÄ Immediate danger? ‚Üí Escalate to crisis counselor + show 988\n‚îú‚îÄ‚îÄ Suicidal ideation? ‚Üí Flag for review + show resources\n‚îú‚îÄ‚îÄ Substance relapse? ‚Üí Connect to sponsor + resources\n‚îú‚îÄ‚îÄ Self-harm mention? ‚Üí Gentle check-in + resources\n‚îî‚îÄ‚îÄ General distress? ‚Üí Supportive response + resources\n```\n\n---\n\n## Technology Selection\n\n### NLP Models for Mental Health (2024)\n\n| Model | Best For | Accuracy | Latency |\n|-------|----------|----------|---------|\n| MentalBERT | Mental health text | 89% | 50ms |\n| GPT-4 + Few-shot | Crisis detection | 92% | 200ms |\n| RoBERTa-Mental | Depression detection | 87% | 40ms |\n| Custom Fine-tuned BERT | Domain-specific | 90%+ | 60ms |\n\n**Timeline**:\n- 2019: BERT fine-tuned for mental health\n- 2021: MentalBERT released\n- 2023: GPT-4 shows strong zero-shot crisis detection\n- 2024: Specialized models for specific conditions\n\n---\n\n## Common Anti-Patterns\n\n### Anti-Pattern 1: Using Generic Sentiment Analysis\n\n**Novice thinking**: \"Negative sentiment = crisis\"\n\n**Problem**: Mental health language is nuanced, context-dependent.\n\n**Wrong approach**:\n```typescript\n// ‚ùå Generic sentiment misses mental health signals\nconst sentiment = analyzeSentiment(text);\n\nif (sentiment.score < -0.5) {\n  alertCrisis();  // Too broad!\n}\n```\n\n**Why wrong**: \"I'm tired\" vs \"I'm tired of living\" - different meanings, same sentiment.\n\n**Correct approach**:\n```typescript\n// ‚úÖ Mental health-specific model\nimport { pipeline } from '@huggingface/transformers';\n\nconst detector = await pipeline('text-classification', 'mental/bert-base-uncased');\n\nconst result = await detector(text, {\n  labels: ['suicidal_ideation', 'self_harm', 'substance_relapse', 'safe']\n});\n\nif (result[0].label === 'suicidal_ideation' && result[0].score > 0.8) {\n  await escalateToCrisisCounselor({\n    text,\n    confidence: result[0].score,\n    timestamp: Date.now()\n  });\n\n  // IMMEDIATELY show crisis resources\n  showCrisisResources({\n    phone: '988',\n    text: 'Text \"HELLO\" to 741741',\n    chat: 'https://988lifeline.org/chat'\n  });\n}\n```\n\n**Timeline context**:\n- 2015: Rule-based keyword matching\n- 2020: BERT fine-tuning for mental health\n- 2024: Multi-label models with context understanding\n\n---\n\n### Anti-Pattern 2: Automated Responses Without Human Review\n\n**Problem**: AI cannot replace empathy, may escalate distress.\n\n**Wrong approach**:\n```typescript\n// ‚ùå AI auto-responds to crisis\nif (isCrisis(text)) {\n  await sendMessage(userId, \"I'm concerned about you. Are you okay?\");\n}\n```\n\n**Why wrong**:\n- Feels robotic, invalidating\n- May increase distress\n- No human judgment\n\n**Correct approach**:\n```typescript\n// ‚úÖ Flag for human review, show resources\nif (isCrisis(text)) {\n  // 1. Flag for counselor review\n  await flagForReview({\n    userId,\n    text,\n    severity: 'high',\n    detectedAt: Date.now(),\n    requiresImmediate: true\n  });\n\n  // 2. Notify on-call counselor\n  await notifyOnCallCounselor({\n    userId,\n    summary: 'Suicidal ideation detected',\n    urgency: 'immediate'\n  });\n\n  // 3. Show resources (no AI message)\n  await showInAppResources({\n    type: 'crisis_support',\n    resources: [\n      { name: '988 Suicide & Crisis Lifeline', link: 'tel:988' },\n      { name: 'Crisis Text Line', link: 'sms:741741' },\n      { name: 'Chat Now', link: 'https://988lifeline.org/chat' }\n    ]\n  });\n\n  // 4. DO NOT send automated \"are you okay\" message\n}\n```\n\n**Human review flow**:\n```\nAI Detection ‚Üí Flag ‚Üí On-call counselor notified ‚Üí Human reaches out\n```\n\n---\n\n### Anti-Pattern 3: Not Providing Immediate Resources\n\n**Problem**: User in crisis needs help NOW, not later.\n\n**Wrong approach**:\n```typescript\n// ‚ùå Just flags, no immediate help\nif (isCrisis(text)) {\n  await logCrisisEvent(userId, text);\n  // User left with no resources\n}\n```\n\n**Correct approach**:\n```typescript\n// ‚úÖ Immediate resources + escalation\nif (isCrisis(text)) {\n  // Show resources IMMEDIATELY (blocking modal)\n  await showCrisisModal({\n    title: 'Resources Available',\n    resources: [\n      {\n        name: '988 Suicide & Crisis Lifeline',\n        description: 'Free, confidential support 24/7',\n        action: 'tel:988',\n        type: 'phone'\n      },\n      {\n        name: 'Crisis Text Line',\n        description: 'Text support with trained counselor',\n        action: 'sms:741741',\n        message: 'HELLO',\n        type: 'text'\n      },\n      {\n        name: 'Chat with counselor',\n        description: 'Online chat support',\n        action: 'https://988lifeline.org/chat',\n        type: 'web'\n      }\n    ],\n    dismissible: true,  // User can close, but resources shown first\n    analytics: { event: 'crisis_resources_shown', source: 'ai_detection' }\n  });\n\n  // Then flag for follow-up\n  await flagForReview({ userId, text, severity: 'high' });\n}\n```\n\n---\n\n### Anti-Pattern 4: Storing Crisis Data Insecurely\n\n**Problem**: Crisis content is extremely sensitive PHI.\n\n**Wrong approach**:\n```typescript\n// ‚ùå Plain text storage\nawait db.logs.insert({\n  userId: user.id,\n  type: 'crisis',\n  content: text,  // Stored in plain text!\n  timestamp: Date.now()\n});\n```\n\n**Why wrong**: Data breach exposes most vulnerable moments.\n\n**Correct approach**:\n```typescript\n// ‚úÖ Encrypted, access-logged, auto-deleted\nimport { encrypt, decrypt } from './encryption';\n\nawait db.crisisEvents.insert({\n  id: generateId(),\n  userId: hashUserId(user.id),  // Hash, not plain ID\n  contentHash: hashContent(text),  // For deduplication only\n  encryptedContent: encrypt(text, process.env.CRISIS_DATA_KEY),\n  detectedAt: Date.now(),\n  reviewedAt: null,\n  reviewedBy: null,\n  autoDeleteAt: Date.now() + (30 * 24 * 60 * 60 * 1000),  // 30 days\n  accessLog: []\n});\n\n// Log all access\nawait logAccess({\n  eventId: crisisEvent.id,\n  accessedBy: counselorId,\n  accessedAt: Date.now(),\n  reason: 'Review for follow-up',\n  ipAddress: hashedIp\n});\n\n// Auto-delete after retention period\nschedule.daily(() => {\n  db.crisisEvents.deleteMany({\n    autoDeleteAt: { $lt: Date.now() }\n  });\n});\n```\n\n**HIPAA Requirements**:\n- Encryption at rest and in transit\n- Access logging\n- Auto-deletion after retention period\n- Minimum necessary access\n\n---\n\n### Anti-Pattern 5: No Escalation Protocol\n\n**Problem**: No clear path from detection to human intervention.\n\n**Wrong approach**:\n```typescript\n// ‚ùå Flags crisis but no escalation process\nif (isCrisis(text)) {\n  await db.flags.insert({ userId, text, flaggedAt: Date.now() });\n  // Now what? Who responds?\n}\n```\n\n**Correct approach**:\n```typescript\n// ‚úÖ Clear escalation protocol\nenum CrisisSeverity {\n  LOW = 'low',        // Distress, no immediate danger\n  MEDIUM = 'medium',  // Self-harm thoughts, no plan\n  HIGH = 'high',      // Suicidal ideation with plan\n  IMMEDIATE = 'immediate'  // Imminent danger\n}\n\nasync function escalateCrisis(detection: CrisisDetection): Promise<void> {\n  const severity = assessSeverity(detection);\n\n  switch (severity) {\n    case CrisisSeverity.IMMEDIATE:\n      // Notify on-call counselor (push notification)\n      await notifyOnCall({\n        userId: detection.userId,\n        severity,\n        requiresResponse: 'immediate',\n        text: detection.text\n      });\n\n      // Send SMS to backup on-call if no response in 5 min\n      setTimeout(async () => {\n        if (!await hasResponded(detection.id)) {\n          await notifyBackupOnCall(detection);\n        }\n      }, 5 * 60 * 1000);\n\n      // Show 988 modal (blocking)\n      await show988Modal(detection.userId);\n      break;\n\n    case CrisisSeverity.HIGH:\n      // Notify on-call counselor (email + push)\n      await notifyOnCall({ severity, requiresResponse: '1 hour' });\n\n      // Show crisis resources\n      await showCrisisResources(detection.userId);\n      break;\n\n    case CrisisSeverity.MEDIUM:\n      // Add to review queue for next business day\n      await addToReviewQueue({ priority: 'high' });\n\n      // Suggest self-help resources\n      await suggestResources(detection.userId, 'coping_strategies');\n      break;\n\n    case CrisisSeverity.LOW:\n      // Add to review queue\n      await addToReviewQueue({ priority: 'normal' });\n      break;\n  }\n\n  // Always log for audit\n  await logEscalation({\n    detectionId: detection.id,\n    severity,\n    actions: ['notified_on_call', 'showed_resources'],\n    timestamp: Date.now()\n  });\n}\n```\n\n---\n\n## Implementation Patterns\n\n### Pattern 1: Multi-Signal Detection\n\n```typescript\ninterface CrisisSignal {\n  type: 'suicidal_ideation' | 'self_harm' | 'substance_relapse' | 'severe_distress';\n  confidence: number;\n  evidence: string[];\n}\n\nasync function detectCrisisSignals(text: string): Promise<CrisisSignal[]> {\n  const signals: CrisisSignal[] = [];\n\n  // Signal 1: NLP model\n  const nlpResult = await mentalHealthNLP(text);\n  if (nlpResult.score > 0.75) {\n    signals.push({\n      type: nlpResult.label,\n      confidence: nlpResult.score,\n      evidence: ['NLP model detection']\n    });\n  }\n\n  // Signal 2: Keyword matching (backup)\n  const keywords = detectKeywords(text);\n  if (keywords.length > 0) {\n    signals.push({\n      type: 'suicidal_ideation',\n      confidence: 0.6,\n      evidence: keywords\n    });\n  }\n\n  // Signal 3: Sentiment + context\n  const sentiment = await sentimentAnalysis(text);\n  const hasHopelessness = /no (hope|point|reason|future)/i.test(text);\n\n  if (sentiment.score < -0.8 && hasHopelessness) {\n    signals.push({\n      type: 'severe_distress',\n      confidence: 0.7,\n      evidence: ['Extreme negative sentiment + hopelessness language']\n    });\n  }\n\n  return signals;\n}\n```\n\n### Pattern 2: Safe Keyword Matching\n\n```typescript\nconst CRISIS_KEYWORDS = {\n  suicidal_ideation: [\n    /\\b(kill|end|take)\\s+(my|own)\\s+life\\b/i,\n    /\\bsuicide\\b/i,\n    /\\bdon'?t\\s+want\\s+to\\s+(live|be here|exist)\\b/i,\n    /\\bbetter off dead\\b/i\n  ],\n  self_harm: [\n    /\\b(cut|cutting|hurt)\\s+(myself|me)\\b/i,\n    /\\bself[- ]harm\\b/i\n  ],\n  substance_relapse: [\n    /\\b(relapsed|used|drank)\\s+(again|today)\\b/i,\n    /\\bback on\\s+(drugs|alcohol)\\b/i\n  ]\n};\n\nfunction detectKeywords(text: string): string[] {\n  const matches: string[] = [];\n\n  for (const [type, patterns] of Object.entries(CRISIS_KEYWORDS)) {\n    for (const pattern of patterns) {\n      if (pattern.test(text)) {\n        matches.push(type);\n      }\n    }\n  }\n\n  return [...new Set(matches)];  // Deduplicate\n}\n```\n\n### Pattern 3: GPT-4 Few-Shot Detection\n\n```typescript\nimport Anthropic from '@anthropic-ai/sdk';\n\nconst client = new Anthropic({ apiKey: process.env.ANTHROPIC_API_KEY });\n\nasync function detectWithClaude(text: string): Promise<CrisisDetection> {\n  const response = await client.messages.create({\n    model: 'claude-3-5-sonnet-20241022',\n    max_tokens: 200,\n    messages: [{\n      role: 'user',\n      content: `You are a mental health crisis detection system. Analyze this text for crisis signals.\n\nText: \"${text}\"\n\nRespond in JSON:\n{\n  \"is_crisis\": boolean,\n  \"severity\": \"none\" | \"low\" | \"medium\" | \"high\" | \"immediate\",\n  \"signals\": [\"suicidal_ideation\" | \"self_harm\" | \"substance_relapse\"],\n  \"confidence\": 0.0-1.0,\n  \"reasoning\": \"brief explanation\"\n}\n\nExamples:\n- \"I'm thinking about ending it all\" ‚Üí { \"is_crisis\": true, \"severity\": \"high\", \"signals\": [\"suicidal_ideation\"], \"confidence\": 0.95 }\n- \"I relapsed today, feeling ashamed\" ‚Üí { \"is_crisis\": true, \"severity\": \"medium\", \"signals\": [\"substance_relapse\"], \"confidence\": 0.9 }\n- \"Had a tough day at work\" ‚Üí { \"is_crisis\": false, \"severity\": \"none\", \"signals\": [], \"confidence\": 0.95 }`\n    }]\n  });\n\n  const result = JSON.parse(response.content[0].text);\n  return result;\n}\n```\n\n---\n\n## Production Checklist\n\n```\n‚ñ° Mental health-specific NLP model (not generic sentiment)\n‚ñ° Human review required before automated action\n‚ñ° Crisis resources shown IMMEDIATELY (988, text line)\n‚ñ° Clear escalation protocol (severity-based)\n‚ñ° Encrypted storage of crisis content\n‚ñ° Access logging for all crisis data access\n‚ñ° Auto-deletion after retention period (30 days)\n‚ñ° On-call counselor notification system\n‚ñ° Backup notification if no response\n‚ñ° False positive tracking (improve model)\n‚ñ° Regular model evaluation with experts\n‚ñ° Ethics review board approval\n```\n\n---\n\n## When to Use vs Avoid\n\n| Scenario | Appropriate? |\n|----------|--------------|\n| Journaling app for recovery | ‚úÖ Yes - monitor for relapses |\n| Support group chat | ‚úÖ Yes - flag concerning posts |\n| Therapy platform messages | ‚úÖ Yes - assist therapists |\n| Public social media | ‚ùå No - privacy concerns |\n| Replace human counselors | ‚ùå Never - AI assists, doesn't replace |\n| Medical diagnosis | ‚ùå Never - not qualified |\n\n---\n\n## References\n\n- `/references/mental-health-nlp.md` - NLP models for mental health\n- `/references/intervention-protocols.md` - Evidence-based intervention strategies\n- `/references/crisis-resources.md` - Hotlines, text lines, and support services\n\n## Scripts\n\n- `scripts/crisis_detector.ts` - Real-time crisis detection system\n- `scripts/model_evaluator.ts` - Evaluate detection accuracy with test cases\n\n---\n\n**This skill guides**: Crisis detection | Mental health NLP | Intervention protocols | Suicide prevention | HIPAA compliance | Ethical AI\n"
    }
  ]
}