{
  "name": "fullstack-debugger",
  "type": "folder",
  "path": "fullstack-debugger",
  "children": [
    {
      "name": "references",
      "type": "folder",
      "path": "fullstack-debugger/references",
      "children": [
        {
          "name": "debug-decision-tree.md",
          "type": "file",
          "path": "fullstack-debugger/references/debug-decision-tree.md",
          "size": 6547,
          "content": "# Debug Decision Tree\n\nUse this flowchart to systematically identify the source of issues.\n\n## Starting Point\n\n```\nIs there an error message?\nâ”œâ”€â”€ YES â†’ Go to \"Error Analysis\"\nâ””â”€â”€ NO  â†’ Go to \"Unexpected Behavior\"\n```\n\n---\n\n## Error Analysis\n\n```\nWhere does the error appear?\nâ”‚\nâ”œâ”€â”€ Browser Console (Red text)\nâ”‚   â”œâ”€â”€ \"Failed to fetch\" / CORS\nâ”‚   â”‚   â””â”€â”€ â†’ Check Worker CORS headers\nâ”‚   â”‚       â†’ Test: curl -H \"Origin: https://site.com\" <endpoint>\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ \"Hydration failed\"\nâ”‚   â”‚   â””â”€â”€ â†’ Client/server mismatch\nâ”‚   â”‚       â†’ Add 'use client' or useEffect wrapper\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ \"TypeError: Cannot read properties of undefined\"\nâ”‚   â”‚   â””â”€â”€ â†’ Data not loaded yet\nâ”‚   â”‚       â†’ Add optional chaining (?.) or loading state\nâ”‚   â”‚\nâ”‚   â””â”€â”€ Other JS error\nâ”‚       â””â”€â”€ â†’ Check stack trace, find component\nâ”‚           â†’ Add error boundary for graceful handling\nâ”‚\nâ”œâ”€â”€ Network Tab (Red request)\nâ”‚   â”œâ”€â”€ Status 401/403\nâ”‚   â”‚   â””â”€â”€ â†’ Authentication issue\nâ”‚   â”‚       â†’ Check JWT, Supabase session, RLS policies\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ Status 404\nâ”‚   â”‚   â””â”€â”€ â†’ Wrong URL or resource deleted\nâ”‚   â”‚       â†’ Verify endpoint exists, check typos\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ Status 500\nâ”‚   â”‚   â””â”€â”€ â†’ Server/Worker error\nâ”‚   â”‚       â†’ Check wrangler tail or Supabase logs\nâ”‚   â”‚\nâ”‚   â””â”€â”€ Status 0 / Canceled\nâ”‚       â””â”€â”€ â†’ Request never completed\nâ”‚           â†’ Check CORS, network, or component unmounted\nâ”‚\nâ”œâ”€â”€ Build/Terminal\nâ”‚   â”œâ”€â”€ TypeScript error\nâ”‚   â”‚   â””â”€â”€ â†’ Type mismatch or cache issue\nâ”‚   â”‚       â†’ Fix types or clear TS cache\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ \"Module not found\"\nâ”‚   â”‚   â””â”€â”€ â†’ Missing dependency or wrong path\nâ”‚   â”‚       â†’ npm install or fix import\nâ”‚   â”‚\nâ”‚   â””â”€â”€ \"Page couldn't be rendered statically\"\nâ”‚       â””â”€â”€ â†’ Dynamic API in static context\nâ”‚           â†’ Add 'force-dynamic' or generateStaticParams\nâ”‚\nâ””â”€â”€ Supabase Dashboard\n    â”œâ”€â”€ Auth error\n    â”‚   â””â”€â”€ â†’ Check redirect URLs, email templates\n    â”‚\n    â””â”€â”€ Query error\n        â””â”€â”€ â†’ Check RLS policies, table exists\n```\n\n---\n\n## Unexpected Behavior\n\n```\nWhat's happening vs expected?\nâ”‚\nâ”œâ”€â”€ Data is empty (but should have results)\nâ”‚   â”œâ”€â”€ API returning empty?\nâ”‚   â”‚   â””â”€â”€ Check Network tab response body\nâ”‚   â”‚       â”œâ”€â”€ Empty array [] â†’ RLS blocking\nâ”‚   â”‚       â”œâ”€â”€ Has data â†’ Frontend not displaying\nâ”‚   â”‚       â””â”€â”€ Error in response â†’ API issue\nâ”‚   â”‚\nâ”‚   â””â”€â”€ Data loads then disappears?\nâ”‚       â””â”€â”€ â†’ Component remounting or state reset\nâ”‚           â†’ Check parent key props, auth redirects\nâ”‚\nâ”œâ”€â”€ Data is stale (showing old values)\nâ”‚   â”œâ”€â”€ Changed in Supabase but not showing?\nâ”‚   â”‚   â””â”€â”€ â†’ Cache issue (browser, React Query, or KV)\nâ”‚   â”‚       â†’ Clear all caches, check cache headers\nâ”‚   â”‚\nâ”‚   â””â”€â”€ Changed in code but not deployed?\nâ”‚       â””â”€â”€ â†’ Check deployment succeeded\nâ”‚           â†’ Purge CDN cache\nâ”‚\nâ”œâ”€â”€ UI looks wrong\nâ”‚   â”œâ”€â”€ Layout broken?\nâ”‚   â”‚   â””â”€â”€ â†’ CSS issue, check Tailwind classes\nâ”‚   â”‚       â†’ Inspect element, check applied styles\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ Flash of unstyled content?\nâ”‚   â”‚   â””â”€â”€ â†’ CSS not loading fast enough\nâ”‚   â”‚       â†’ Check font loading, critical CSS\nâ”‚   â”‚\nâ”‚   â””â”€â”€ Different on mobile vs desktop?\nâ”‚       â””â”€â”€ â†’ Responsive breakpoints\nâ”‚           â†’ Check Tailwind sm:/md:/lg: classes\nâ”‚\nâ”œâ”€â”€ Auth not working\nâ”‚   â”œâ”€â”€ Can't log in?\nâ”‚   â”‚   â””â”€â”€ â†’ Check Supabase Auth settings\nâ”‚   â”‚       â†’ Verify redirect URLs match\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ Logged in but shows as logged out?\nâ”‚   â”‚   â””â”€â”€ â†’ Session not persisting\nâ”‚   â”‚       â†’ Check cookies, localStorage, AuthContext\nâ”‚   â”‚\nâ”‚   â””â”€â”€ Works locally, fails in production?\nâ”‚       â””â”€â”€ â†’ Environment variables missing\nâ”‚           â†’ Check Cloudflare Pages env vars\nâ”‚\nâ””â”€â”€ Slow performance\n    â”œâ”€â”€ Initial load slow?\n    â”‚   â””â”€â”€ â†’ Bundle too large\n    â”‚       â†’ Analyze with next/bundle-analyzer\n    â”‚\n    â”œâ”€â”€ Interactions slow?\n    â”‚   â””â”€â”€ â†’ Re-renders or heavy computation\n    â”‚       â†’ Profile with React DevTools\n    â”‚\n    â””â”€â”€ API calls slow?\n        â””â”€â”€ â†’ Backend or network issue\n            â†’ Check wrangler tail for timing\n```\n\n---\n\n## Quick Diagnostic Commands\n\n```bash\n# 1. Is the site even reachable?\ncurl -s -o /dev/null -w \"%{http_code}\" https://yoursite.com\n\n# 2. Is the API working?\ncurl -s https://your-worker.workers.dev/health\n\n# 3. Are CORS headers present?\ncurl -s -D - -o /dev/null -H \"Origin: https://yoursite.com\" https://your-api.com/endpoint\n\n# 4. What's in the worker logs?\ncd workers/your-worker && npx wrangler tail\n\n# 5. Is Supabase accessible?\nnode -e \"require('@supabase/supabase-js').createClient('URL','KEY').from('table').select('*').limit(1).then(console.log)\"\n\n# 6. Is the build clean?\nnpm run build 2>&1 | grep -E \"(error|Error|failed)\"\n\n# 7. TypeScript happy?\nnpx tsc --noEmit 2>&1 | head -20\n```\n\n---\n\n## Layer Isolation Test\n\nWhen you can't tell which layer is broken:\n\n```\n1. Test Supabase directly (dashboard or curl)\n   â””â”€â”€ Works? â†’ Problem is NOT Supabase\n\n2. Test Worker directly (curl, no browser)\n   â””â”€â”€ Works? â†’ Problem is NOT Worker\n\n3. Test in browser devtools (Network tab)\n   â””â”€â”€ Request succeeds? â†’ Problem is frontend code\n\n4. Test locally (npm run dev)\n   â””â”€â”€ Works locally? â†’ Problem is deployment/config\n\n5. Test in incognito (fresh state)\n   â””â”€â”€ Works in incognito? â†’ Problem is cached state\n```\n\n---\n\n## The \"Nothing Is Working\" Checklist\n\nWhen everything seems broken:\n\n```\n[ ] Is the internet working? (ping google.com)\n[ ] Is Node running correctly? (node -v)\n[ ] Are dependencies installed? (npm ls --depth=0)\n[ ] Is the dev server running? (npm run dev)\n[ ] Are environment variables set? (echo $NEXT_PUBLIC_...)\n[ ] Is git clean or are there conflicts? (git status)\n[ ] Did you save all files? (check unsaved indicators)\n[ ] Is the TypeScript cache haunting you? (clear it!)\n[ ] Are you on the right branch? (git branch --show-current)\n[ ] Did something change recently? (git log -5)\n```\n"
        },
        {
          "name": "error-patterns.md",
          "type": "file",
          "path": "fullstack-debugger/references/error-patterns.md",
          "size": 5694,
          "content": "# Common Error Patterns & Solutions\n\n## Browser Console Errors\n\n### \"Failed to fetch\" / \"TypeError: Failed to fetch\"\n**Cause:** Network request failed - usually CORS, network issue, or server down\n**Debug:**\n```bash\n# Test endpoint directly\ncurl -v https://your-endpoint.workers.dev/api/test\n\n# Check CORS\ncurl -H \"Origin: https://yoursite.com\" -v https://your-endpoint.workers.dev/api/test\n```\n**Fix:** Add CORS headers to worker response\n\n### \"Hydration failed because the initial UI does not match\"\n**Cause:** Server HTML differs from client render (dates, random values, browser APIs)\n**Debug:**\n```jsx\n// Add to suspect component\nuseEffect(() => {\n  console.log('Mounted - client only');\n}, []);\n```\n**Fix:** Wrap dynamic content in client-only component:\n```jsx\nconst [mounted, setMounted] = useState(false);\nuseEffect(() => setMounted(true), []);\nif (!mounted) return <Skeleton />;\n```\n\n### \"Cannot read properties of undefined\"\n**Cause:** Accessing nested property before data loads\n**Fix:**\n```jsx\n// Before\ndata.user.name\n\n// After\ndata?.user?.name ?? 'Unknown'\n```\n\n### \"Invalid hook call\"\n**Cause:** Hooks called conditionally, in loops, or outside components\n**Debug:** Check for early returns before hooks\n**Fix:** Move hooks to top of component, before any conditionals\n\n---\n\n## Supabase Errors\n\n### Empty results (no error, but data = [])\n**Cause:** RLS policy blocking access (99% of cases)\n**Debug:**\n```sql\n-- Check policies\nSELECT * FROM pg_policies WHERE tablename = 'your_table';\n\n-- Test as anon\nSET ROLE anon;\nSELECT * FROM your_table LIMIT 1;\n```\n**Fix:** Add SELECT policy: `CREATE POLICY \"name\" ON table FOR SELECT USING (true);`\n\n### \"JWT expired\"\n**Cause:** Session token expired\n**Fix:**\n```javascript\n// Refresh session\nconst { data, error } = await supabase.auth.refreshSession();\n```\n\n### \"relation does not exist\"\n**Cause:** Table doesn't exist, wrong schema, or typo\n**Debug:**\n```sql\nSELECT table_name FROM information_schema.tables WHERE table_schema = 'public';\n```\n\n### \"new row violates row-level security policy\"\n**Cause:** INSERT/UPDATE blocked by RLS\n**Debug:** Check INSERT/UPDATE policies, verify auth.uid() matches\n\n---\n\n## Cloudflare Worker Errors\n\n### 1101 Worker threw exception\n**Cause:** Unhandled exception in worker code\n**Debug:**\n```bash\ncd workers/your-worker\nnpx wrangler tail\n# Then trigger the error\n```\n**Fix:** Add try/catch, check for undefined values\n\n### 1102 Worker exceeded CPU time limit\n**Cause:** Worker took too long (50ms free, 30s paid)\n**Fix:** Optimize code, use streaming, cache results\n\n### 524 A timeout occurred\n**Cause:** Worker took longer than 100 seconds\n**Fix:** Break into smaller operations, use Durable Objects\n\n### KV \"key not found\"\n**Cause:** Key doesn't exist or expired\n**Debug:**\n```bash\nnpx wrangler kv:key get --namespace-id=YOUR_NS \"your:key\"\n```\n\n---\n\n## Next.js Build Errors\n\n### \"Page X couldn't be rendered statically\"\n**Cause:** Using dynamic APIs (cookies, headers, searchParams) without proper handling\n**Fix:**\n```typescript\n// Add to page\nexport const dynamic = 'force-dynamic';\n// or wrap in Suspense\n```\n\n### \"Module not found: Can't resolve 'X'\"\n**Cause:** Missing dependency, wrong import path, or server/client mismatch\n**Debug:**\n```bash\nnpm ls X  # Check if installed\ngrep -r \"from 'X'\" src/  # Find imports\n```\n**Fix:** `npm install X` or fix import path\n\n### \"You're importing a component that needs useState\"\n**Cause:** Using client hook in server component\n**Fix:** Add `'use client'` directive at top of file\n\n### Out of memory during build\n**Cause:** Large pages, too many images, complex dependencies\n**Fix:**\n```bash\n# Increase Node memory\nNODE_OPTIONS=\"--max-old-space-size=4096\" npm run build\n```\n\n---\n\n## TypeScript Errors\n\n### \"Cannot find module\" (but it exists)\n**Cause:** Stale TypeScript cache\n**Fix:**\n```bash\nrm -rf node_modules/.cache/typescript tsconfig.tsbuildinfo\nnpx tsc --build --clean\n```\n\n### \"Type X is not assignable to type Y\"\n**Debug:** Look at both types, find the mismatch\n**Fix:** Adjust type, add assertion, or fix data\n\n### \"Object is possibly 'undefined'\"\n**Fix:** Add null check or optional chaining:\n```typescript\n// Before\nuser.name\n\n// After\nuser?.name ?? 'default'\n```\n\n---\n\n## Authentication Issues\n\n### User stuck in logged-out state\n**Debug:**\n```javascript\n// In browser console\nconsole.log(await supabase.auth.getSession());\nlocalStorage.getItem('sb-xxx-auth-token');\n```\n**Common causes:**\n- Wrong Supabase URL (http vs https)\n- Site URL mismatch in Supabase dashboard\n- Cookie blocked (Safari, incognito)\n\n### Redirect loop on auth\n**Cause:** Auth callback not handling state correctly\n**Fix:** Check redirect URLs in Supabase dashboard match your app\n\n---\n\n## Performance Issues\n\n### Slow initial load\n**Debug:**\n```bash\n# Check bundle size\nnpx @next/bundle-analyzer\n```\n**Fix:**\n- Dynamic imports for large components\n- Image optimization\n- Remove unused dependencies\n\n### \"Stale closure\" / state not updating\n**Cause:** Callback using old state value\n**Fix:** Use functional update or add to dependency array:\n```javascript\nsetCount(prev => prev + 1);  // Not setCount(count + 1)\n```\n\n---\n\n## Deployment Issues\n\n### Works locally, fails in production\n**Debug checklist:**\n1. Environment variables set in Cloudflare Pages?\n2. Build command correct?\n3. Output directory correct (`out` for static)?\n4. Node version matches?\n\n### Changes not reflecting after deploy\n**Cause:** CDN/browser caching\n**Fix:**\n```bash\n# Purge Cloudflare cache\ncurl -X POST \"https://api.cloudflare.com/client/v4/zones/ZONE/purge_cache\" \\\n  -H \"Authorization: Bearer TOKEN\" \\\n  -d '{\"purge_everything\":true}'\n\n# Or add cache busting\n?v=2 to resource URLs\n```\n"
        }
      ]
    },
    {
      "name": "scripts",
      "type": "folder",
      "path": "fullstack-debugger/scripts",
      "children": [
        {
          "name": "check-cors.sh",
          "type": "file",
          "path": "fullstack-debugger/scripts/check-cors.sh",
          "size": 3743,
          "content": "#!/bin/bash\n# CORS Diagnostic Script\n# Tests if CORS headers are correctly configured on worker endpoints\n\nset -e\n\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m'\n\n# Default values\nORIGIN=\"${1:-https://jbuds4life.pages.dev}\"\nENDPOINT=\"${2:-https://jb4l-meeting-proxy.erich-owens.workers.dev/health}\"\n\necho \"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\"\necho \"â•‘         CORS DIAGNOSTIC TOOL               â•‘\"\necho \"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"\necho \"\"\necho \"Testing: $ENDPOINT\"\necho \"Origin:  $ORIGIN\"\necho \"\"\n\n# Test 1: Simple GET request\necho \"=== Test 1: Simple GET Request ===\"\nRESPONSE=$(curl -s -D - -o /dev/null -H \"Origin: $ORIGIN\" \"$ENDPOINT\")\necho \"$RESPONSE\" | grep -iE \"(HTTP|access-control|x-)\" || true\n\n# Check for Access-Control-Allow-Origin\nif echo \"$RESPONSE\" | grep -qi \"access-control-allow-origin\"; then\n  ACAO=$(echo \"$RESPONSE\" | grep -i \"access-control-allow-origin\" | tr -d '\\r')\n  echo -e \"${GREEN}âœ… CORS header present: $ACAO${NC}\"\nelse\n  echo -e \"${RED}âŒ No Access-Control-Allow-Origin header!${NC}\"\nfi\n\n# Test 2: Preflight OPTIONS request\necho \"\"\necho \"=== Test 2: Preflight OPTIONS Request ===\"\nPREFLIGHT=$(curl -s -D - -o /dev/null \\\n  -X OPTIONS \\\n  -H \"Origin: $ORIGIN\" \\\n  -H \"Access-Control-Request-Method: POST\" \\\n  -H \"Access-Control-Request-Headers: Content-Type, Authorization\" \\\n  \"$ENDPOINT\")\n\necho \"$PREFLIGHT\" | grep -iE \"(HTTP|access-control)\" || true\n\n# Check preflight response\nHTTP_STATUS=$(echo \"$PREFLIGHT\" | head -1 | awk '{print $2}')\nif [ \"$HTTP_STATUS\" = \"200\" ] || [ \"$HTTP_STATUS\" = \"204\" ]; then\n  echo -e \"${GREEN}âœ… Preflight returns $HTTP_STATUS${NC}\"\nelse\n  echo -e \"${RED}âŒ Preflight returns $HTTP_STATUS (expected 200 or 204)${NC}\"\nfi\n\n# Check required headers\necho \"\"\necho \"=== Required CORS Headers ===\"\nfor HEADER in \"Access-Control-Allow-Origin\" \"Access-Control-Allow-Methods\" \"Access-Control-Allow-Headers\"; do\n  if echo \"$PREFLIGHT\" | grep -qi \"$HEADER\"; then\n    VALUE=$(echo \"$PREFLIGHT\" | grep -i \"$HEADER\" | cut -d: -f2- | tr -d '\\r')\n    echo -e \"${GREEN}âœ… $HEADER:$VALUE${NC}\"\n  else\n    echo -e \"${RED}âŒ Missing: $HEADER${NC}\"\n  fi\ndone\n\n# Test 3: Actual POST (if endpoint supports it)\necho \"\"\necho \"=== Test 3: POST Request with JSON ===\"\nPOST_RESPONSE=$(curl -s -D - -o /dev/null \\\n  -X POST \\\n  -H \"Origin: $ORIGIN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"test\": true}' \\\n  \"$ENDPOINT\" 2>&1 || true)\n\nPOST_STATUS=$(echo \"$POST_RESPONSE\" | head -1 | awk '{print $2}')\necho \"POST Status: $POST_STATUS\"\necho \"$POST_RESPONSE\" | grep -iE \"access-control\" || echo \"(no CORS headers in response)\"\n\n# Summary\necho \"\"\necho \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"\necho \"CORS CHECKLIST\"\necho \"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"\ncat << 'EOF'\nWorker should include in ALL responses (including OPTIONS):\n\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*',  // or specific origin\n  'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n  'Access-Control-Max-Age': '86400',\n};\n\n// Handle preflight\nif (request.method === 'OPTIONS') {\n  return new Response(null, { status: 204, headers: corsHeaders });\n}\n\n// Add to all other responses\nreturn new Response(body, {\n  status: 200,\n  headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n});\nEOF\n"
        },
        {
          "name": "check-rls.js",
          "type": "file",
          "path": "fullstack-debugger/scripts/check-rls.js",
          "size": 4128,
          "content": "#!/usr/bin/env node\n/**\n * RLS Policy Diagnostic Script\n *\n * Checks if Row Level Security policies are allowing/blocking access correctly.\n * The #1 cause of \"empty results but no error\" issues in Supabase.\n *\n * Usage:\n *   node check-rls.js                    # Uses env vars\n *   node check-rls.js <url> <anon_key>   # Explicit credentials\n */\n\nconst TABLES_TO_CHECK = [\n  'profiles',\n  'meetings',\n  'forum_posts',\n  'forum_comments',\n  'journal_entries',\n  'daily_checkins',\n  'saved_meetings',\n  'recovery_plans',\n  'safety_plans'\n];\n\nasync function main() {\n  // Dynamic import for ESM compatibility\n  const { createClient } = await import('@supabase/supabase-js');\n\n  const url = process.argv[2] || process.env.NEXT_PUBLIC_SUPABASE_URL;\n  const key = process.argv[3] || process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\n  if (!url || !key) {\n    console.error('Usage: node check-rls.js <SUPABASE_URL> <ANON_KEY>');\n    console.error('Or set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY');\n    process.exit(1);\n  }\n\n  const supabase = createClient(url, key);\n\n  console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');\n  console.log('â•‘         RLS POLICY DIAGNOSTIC              â•‘');\n  console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n');\n  console.log(`URL: ${url.substring(0, 40)}...`);\n  console.log(`Testing as: anonymous (anon key)\\n`);\n\n  const results = {\n    accessible: [],\n    blocked: [],\n    errors: []\n  };\n\n  for (const table of TABLES_TO_CHECK) {\n    process.stdout.write(`Checking ${table.padEnd(20)}`);\n\n    try {\n      const { data, error, count } = await supabase\n        .from(table)\n        .select('*', { count: 'exact' })\n        .limit(1);\n\n      if (error) {\n        if (error.code === 'PGRST204') {\n          // Table doesn't exist\n          console.log(`âš ï¸  TABLE NOT FOUND`);\n        } else if (error.code === '42501') {\n          // Permission denied\n          console.log(`ğŸ”’ BLOCKED BY RLS`);\n          results.blocked.push({ table, error: error.message });\n        } else {\n          console.log(`âŒ ERROR: ${error.message}`);\n          results.errors.push({ table, error: error.message });\n        }\n      } else if (count === 0) {\n        console.log(`âœ… OK (0 rows - empty or filtered)`);\n        results.accessible.push({ table, count: 0 });\n      } else {\n        console.log(`âœ… OK (${count} rows accessible)`);\n        results.accessible.push({ table, count });\n      }\n    } catch (err) {\n      console.log(`âŒ EXCEPTION: ${err.message}`);\n      results.errors.push({ table, error: err.message });\n    }\n  }\n\n  // Summary\n  console.log('\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');\n  console.log('SUMMARY');\n  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');\n  console.log(`âœ… Accessible: ${results.accessible.length} tables`);\n  console.log(`ğŸ”’ Blocked:    ${results.blocked.length} tables`);\n  console.log(`âŒ Errors:     ${results.errors.length} tables`);\n\n  if (results.blocked.length > 0) {\n    console.log('\\nğŸ”’ BLOCKED TABLES (need RLS policy review):');\n    results.blocked.forEach(({ table, error }) => {\n      console.log(`   - ${table}: ${error}`);\n    });\n    console.log('\\nTo fix, add a SELECT policy in Supabase:');\n    console.log('   CREATE POLICY \"Allow public read\" ON table_name');\n    console.log('   FOR SELECT USING (true);');\n  }\n\n  if (results.errors.length > 0) {\n    console.log('\\nâŒ TABLES WITH ERRORS:');\n    results.errors.forEach(({ table, error }) => {\n      console.log(`   - ${table}: ${error}`);\n    });\n  }\n\n  // Exit with error if any issues\n  if (results.blocked.length > 0 || results.errors.length > 0) {\n    process.exit(1);\n  }\n}\n\nmain().catch(err => {\n  console.error('Fatal error:', err);\n  process.exit(1);\n});\n"
        },
        {
          "name": "diagnose.sh",
          "type": "file",
          "path": "fullstack-debugger/scripts/diagnose.sh",
          "size": 4658,
          "content": "#!/bin/bash\n# Comprehensive diagnostic script for Next.js + Cloudflare + Supabase apps\n# Run from the project root (next-app/ directory)\n\nset -e\n\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m' # No Color\n\necho -e \"${BLUE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}\"\necho -e \"${BLUE}â•‘       FULLSTACK DIAGNOSTIC TOOL            â•‘${NC}\"\necho -e \"${BLUE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\"\n\n# 1. Environment Check\necho -e \"\\n${YELLOW}=== Environment ===${NC}\"\necho -n \"Node: \" && node -v 2>/dev/null || echo -e \"${RED}NOT INSTALLED${NC}\"\necho -n \"npm: \" && npm -v 2>/dev/null || echo -e \"${RED}NOT INSTALLED${NC}\"\necho -n \"Wrangler: \" && npx wrangler --version 2>/dev/null || echo -e \"${YELLOW}Not installed (needed for Workers)${NC}\"\n\n# 2. Git Status\necho -e \"\\n${YELLOW}=== Git Status ===${NC}\"\nif [ -d .git ]; then\n  git status --short\n  echo \"Branch: $(git branch --show-current)\"\n  echo \"Last commit: $(git log -1 --oneline)\"\nelse\n  echo -e \"${YELLOW}Not a git repository${NC}\"\nfi\n\n# 3. Dependencies Check\necho -e \"\\n${YELLOW}=== Dependencies ===${NC}\"\nif [ -f package.json ]; then\n  MISSING=$(npm ls --depth=0 2>&1 | grep -E \"(UNMET|missing|ERR)\" | head -10)\n  if [ -z \"$MISSING\" ]; then\n    echo -e \"${GREEN}All dependencies OK${NC}\"\n  else\n    echo -e \"${RED}Missing dependencies:${NC}\"\n    echo \"$MISSING\"\n  fi\nelse\n  echo -e \"${RED}No package.json found${NC}\"\nfi\n\n# 4. TypeScript Check\necho -e \"\\n${YELLOW}=== TypeScript ===${NC}\"\nif [ -f tsconfig.json ]; then\n  TS_ERRORS=$(npx tsc --noEmit 2>&1 | head -20)\n  if [ -z \"$TS_ERRORS\" ]; then\n    echo -e \"${GREEN}No TypeScript errors${NC}\"\n  else\n    echo -e \"${RED}TypeScript errors:${NC}\"\n    echo \"$TS_ERRORS\"\n  fi\nelse\n  echo -e \"${YELLOW}No tsconfig.json found${NC}\"\nfi\n\n# 5. ESLint Check\necho -e \"\\n${YELLOW}=== ESLint ===${NC}\"\nLINT_ERRORS=$(npm run lint 2>&1 | tail -20)\nif echo \"$LINT_ERRORS\" | grep -q \"error\"; then\n  echo -e \"${RED}Lint errors found:${NC}\"\n  echo \"$LINT_ERRORS\" | grep -E \"(error|Error)\" | head -10\nelse\n  echo -e \"${GREEN}No lint errors${NC}\"\nfi\n\n# 6. Build Check\necho -e \"\\n${YELLOW}=== Build Test ===${NC}\"\necho \"Running build (this may take a moment)...\"\nBUILD_OUTPUT=$(npm run build 2>&1)\nif echo \"$BUILD_OUTPUT\" | grep -q \"Export successful\\|Compiled successfully\\|Build completed\"; then\n  echo -e \"${GREEN}Build successful${NC}\"\nelse\n  echo -e \"${RED}Build failed:${NC}\"\n  echo \"$BUILD_OUTPUT\" | tail -30\nfi\n\n# 7. Environment Variables\necho -e \"\\n${YELLOW}=== Environment Variables ===${NC}\"\nif [ -f .env.local ]; then\n  echo \"Found .env.local with $(wc -l < .env.local | tr -d ' ') lines\"\n  grep -E \"^NEXT_PUBLIC_\" .env.local 2>/dev/null | sed 's/=.*/=***/' || true\nelse\n  echo -e \"${YELLOW}No .env.local file (using system env)${NC}\"\nfi\n\n# Check required vars\nfor VAR in NEXT_PUBLIC_SUPABASE_URL NEXT_PUBLIC_SUPABASE_ANON_KEY; do\n  if grep -q \"$VAR\" .env.local 2>/dev/null || [ -n \"${!VAR}\" ]; then\n    echo -e \"${GREEN}$VAR: Set${NC}\"\n  else\n    echo -e \"${RED}$VAR: Missing!${NC}\"\n  fi\ndone\n\n# 8. Workers Check\necho -e \"\\n${YELLOW}=== Cloudflare Workers ===${NC}\"\nif [ -d workers ]; then\n  for worker in workers/*/; do\n    WORKER_NAME=$(basename \"$worker\")\n    if [ -f \"$worker/wrangler.toml\" ]; then\n      echo -n \"$WORKER_NAME: \"\n      if (cd \"$worker\" && npx wrangler whoami >/dev/null 2>&1); then\n        echo -e \"${GREEN}configured${NC}\"\n      else\n        echo -e \"${YELLOW}not authenticated${NC}\"\n      fi\n    fi\n  done\nelse\n  echo \"No workers directory found\"\nfi\n\n# 9. Supabase Check\necho -e \"\\n${YELLOW}=== Supabase ===${NC}\"\nif command -v supabase &> /dev/null; then\n  supabase status 2>/dev/null || echo \"Supabase not linked to this project\"\nelse\n  echo \"Supabase CLI not installed\"\nfi\n\n# 10. Port Check\necho -e \"\\n${YELLOW}=== Port Status ===${NC}\"\nfor PORT in 3000 3001 5432 54321; do\n  if lsof -i :$PORT >/dev/null 2>&1; then\n    PROC=$(lsof -i :$PORT | tail -1 | awk '{print $1}')\n    echo -e \"Port $PORT: ${YELLOW}In use by $PROC${NC}\"\n  else\n    echo -e \"Port $PORT: ${GREEN}Available${NC}\"\n  fi\ndone\n\n# Summary\necho -e \"\\n${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\"\necho -e \"${BLUE}Diagnostic complete. Check any RED items above.${NC}\"\necho -e \"${BLUE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}\"\n"
        },
        {
          "name": "inspect-cache.sh",
          "type": "file",
          "path": "fullstack-debugger/scripts/inspect-cache.sh",
          "size": 4268,
          "content": "#!/bin/bash\n# Cache Inspection Script\n# Inspects Cloudflare KV cache for meeting-proxy\n\nset -e\n\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\n# KV Namespace IDs (update these for your project)\nMEETING_CACHE_NS=\"${MEETING_CACHE_NS:-104a373dda314cfc8d267b4b2ffa92b9}\"\nRATE_LIMIT_NS=\"${RATE_LIMIT_NS:-7ed18d6c32334aaeb3450ad6e140c985}\"\n\necho \"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\"\necho \"â•‘         CACHE INSPECTION TOOL              â•‘\"\necho \"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\"\necho \"\"\n\n# Check wrangler auth\nif ! npx wrangler whoami > /dev/null 2>&1; then\n  echo -e \"${YELLOW}Not authenticated with Cloudflare. Run: npx wrangler login${NC}\"\n  exit 1\nfi\n\n# Function to list KV keys\nlist_kv_keys() {\n  local NS_ID=$1\n  local NS_NAME=$2\n  echo -e \"\\n${BLUE}=== $NS_NAME ===${NC}\"\n  echo \"Namespace ID: $NS_ID\"\n  echo \"\"\n\n  KEYS=$(npx wrangler kv:key list --namespace-id=\"$NS_ID\" 2>/dev/null || echo \"[]\")\n\n  if [ \"$KEYS\" = \"[]\" ]; then\n    echo \"  (empty)\"\n  else\n    echo \"$KEYS\" | jq -r '.[].name' 2>/dev/null | head -20 || echo \"$KEYS\" | head -20\n\n    COUNT=$(echo \"$KEYS\" | jq 'length' 2>/dev/null || echo \"?\")\n    echo \"\"\n    echo \"Total keys: $COUNT\"\n    if [ \"$COUNT\" -gt 20 ]; then\n      echo \"(showing first 20)\"\n    fi\n  fi\n}\n\n# Function to get a specific key\nget_kv_value() {\n  local NS_ID=$1\n  local KEY=$2\n  echo -e \"\\n${BLUE}=== Value for '$KEY' ===${NC}\"\n  VALUE=$(npx wrangler kv:key get --namespace-id=\"$NS_ID\" \"$KEY\" 2>/dev/null)\n\n  if [ -z \"$VALUE\" ]; then\n    echo \"(not found or empty)\"\n  else\n    # Pretty print if JSON\n    if echo \"$VALUE\" | jq . > /dev/null 2>&1; then\n      echo \"$VALUE\" | jq '.' | head -50\n      LEN=$(echo \"$VALUE\" | wc -c)\n      if [ \"$LEN\" -gt 5000 ]; then\n        echo \"... (truncated, total $LEN bytes)\"\n      fi\n    else\n      echo \"$VALUE\" | head -20\n    fi\n  fi\n}\n\n# Function to check cache hit rate\ncheck_cache_status() {\n  local LAT=$1\n  local LNG=$2\n  local RADIUS=${3:-25}\n\n  echo -e \"\\n${BLUE}=== Cache Status Check ===${NC}\"\n  echo \"Location: ($LAT, $LNG), Radius: ${RADIUS}mi\"\n\n  RESPONSE=$(curl -s -D - -o /dev/null \\\n    -H \"Origin: https://jbuds4life.pages.dev\" \\\n    \"https://jb4l-meeting-proxy.erich-owens.workers.dev/api/all?lat=$LAT&lng=$LNG&radius=$RADIUS\" 2>&1)\n\n  CACHE=$(echo \"$RESPONSE\" | grep -i \"x-cache:\" | tr -d '\\r' || echo \"x-cache: unknown\")\n  GEOHASH=$(echo \"$RESPONSE\" | grep -i \"x-geohash:\" | tr -d '\\r' || echo \"x-geohash: unknown\")\n  SOURCE=$(echo \"$RESPONSE\" | grep -i \"x-source:\" | tr -d '\\r' || echo \"\")\n\n  echo \"$CACHE\"\n  echo \"$GEOHASH\"\n  [ -n \"$SOURCE\" ] && echo \"$SOURCE\"\n}\n\n# Main menu\ncase \"${1:-list}\" in\n  list)\n    list_kv_keys \"$MEETING_CACHE_NS\" \"Meeting Cache\"\n    ;;\n\n  rate)\n    list_kv_keys \"$RATE_LIMIT_NS\" \"Rate Limits\"\n    ;;\n\n  get)\n    if [ -z \"$2\" ]; then\n      echo \"Usage: $0 get <key>\"\n      exit 1\n    fi\n    get_kv_value \"$MEETING_CACHE_NS\" \"$2\"\n    ;;\n\n  status)\n    LAT=\"${2:-45.5152}\"\n    LNG=\"${3:--122.6784}\"\n    check_cache_status \"$LAT\" \"$LNG\"\n    ;;\n\n  warm)\n    echo \"Warming cache for top metros...\"\n    curl -s -H \"Origin: https://jbuds4life.pages.dev\" \\\n      \"https://jb4l-meeting-proxy.erich-owens.workers.dev/warm\"\n    echo \"\"\n    ;;\n\n  clear)\n    if [ -z \"$2\" ]; then\n      echo \"Usage: $0 clear <key>\"\n      echo \"       $0 clear meetings:c20  # Clear Portland cache\"\n      exit 1\n    fi\n    echo \"Deleting key: $2\"\n    npx wrangler kv:key delete --namespace-id=\"$MEETING_CACHE_NS\" \"$2\"\n    echo -e \"${GREEN}Deleted${NC}\"\n    ;;\n\n  *)\n    echo \"Usage: $0 <command> [args]\"\n    echo \"\"\n    echo \"Commands:\"\n    echo \"  list              List meeting cache keys\"\n    echo \"  rate              List rate limit keys\"\n    echo \"  get <key>         Get value for a key\"\n    echo \"  status [lat lng]  Check cache status for location\"\n    echo \"  warm              Warm cache for top metros\"\n    echo \"  clear <key>       Delete a cache key\"\n    echo \"\"\n    echo \"Examples:\"\n    echo \"  $0 list\"\n    echo \"  $0 get meetings:c20:25\"\n    echo \"  $0 status 45.52 -122.68\"\n    echo \"  $0 clear meetings:c20:25\"\n    ;;\nesac\n"
        }
      ]
    },
    {
      "name": "SKILL.md",
      "type": "file",
      "path": "fullstack-debugger/SKILL.md",
      "size": 15413,
      "content": "---\nname: fullstack-debugger\ndescription: \"Expert debugger for Next.js + Cloudflare Workers + Supabase stacks. Systematic troubleshooting for auth, caching, workers, RLS, CORS, and build issues. Activate on: 'debug', 'not working', 'error', 'broken', '500', '401', '403', 'cache issue', 'RLS', 'CORS'. NOT for: feature development (use language skills), architecture design (use system-architect).\"\nallowed-tools: Read,Write,Edit,Bash,Grep,Glob,WebFetch,mcp__supabase__*,mcp__playwright__*\ncategory: Code Quality & Testing\ntags:\n  - debugging\n  - nextjs\n  - cloudflare-workers\n  - supabase\n  - troubleshooting\npairs-with:\n  - skill: devops-automator\n    reason: Deployment and infrastructure issues\n  - skill: site-reliability-engineer\n    reason: Production incidents\n---\n\n# Fullstack Debugger\n\nExpert debugger for modern web stacks: Next.js 15, Cloudflare Workers, Supabase, and edge deployments. Systematic, evidence-based troubleshooting.\n\n## Activation Triggers\n\n**Activate on:** \"debug\", \"not working\", \"broken\", \"error\", \"500 error\", \"401\", \"403\", \"cache issue\", \"CORS error\", \"RLS policy\", \"auth not working\", \"blank page\", \"hydration error\", \"build failed\", \"worker not responding\"\n\n**NOT for:** Feature development â†’ language skills | Architecture â†’ `system-architect` | Performance optimization â†’ `performance-engineer`\n\n## Debug Philosophy\n\n```\n1. REPRODUCE â†’ Can you make it fail consistently?\n2. ISOLATE   â†’ Which layer is broken?\n3. EVIDENCE  â†’ What do logs/network/state show?\n4. HYPOTHESIZE â†’ What could cause this?\n5. TEST      â†’ Validate one hypothesis at a time\n6. FIX       â†’ Minimal change that resolves issue\n7. VERIFY    â†’ Confirm fix doesn't break other things\n```\n\n## Architecture Layers\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                    DEBUGGING LAYERS                         â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚                                                             â”‚\nâ”‚  Layer 1: Browser/Client                                    â”‚\nâ”‚  â”œâ”€â”€ Console errors, network tab, React DevTools           â”‚\nâ”‚  â”œâ”€â”€ localStorage/sessionStorage state                     â”‚\nâ”‚  â””â”€â”€ React Query cache state                               â”‚\nâ”‚                                                             â”‚\nâ”‚  Layer 2: Next.js Application                              â”‚\nâ”‚  â”œâ”€â”€ Server components vs client components                â”‚\nâ”‚  â”œâ”€â”€ Build output and static generation                    â”‚\nâ”‚  â”œâ”€â”€ API routes (if any)                                   â”‚\nâ”‚  â””â”€â”€ Hydration mismatches                                  â”‚\nâ”‚                                                             â”‚\nâ”‚  Layer 3: Cloudflare Workers                               â”‚\nâ”‚  â”œâ”€â”€ Worker logs (wrangler tail)                           â”‚\nâ”‚  â”œâ”€â”€ KV cache state                                        â”‚\nâ”‚  â”œâ”€â”€ CORS headers                                          â”‚\nâ”‚  â””â”€â”€ Rate limiting                                         â”‚\nâ”‚                                                             â”‚\nâ”‚  Layer 4: Supabase                                         â”‚\nâ”‚  â”œâ”€â”€ Auth state and JWT tokens                             â”‚\nâ”‚  â”œâ”€â”€ RLS policies (most common issue!)                     â”‚\nâ”‚  â”œâ”€â”€ Database queries and indexes                          â”‚\nâ”‚  â””â”€â”€ Realtime subscriptions                                â”‚\nâ”‚                                                             â”‚\nâ”‚  Layer 5: External APIs                                    â”‚\nâ”‚  â”œâ”€â”€ Third-party service availability                      â”‚\nâ”‚  â”œâ”€â”€ API rate limits                                       â”‚\nâ”‚  â””â”€â”€ Response format changes                               â”‚\nâ”‚                                                             â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n## Quick Diagnosis Commands\n\n### Check Everything At Once\n\n```bash\n# Run from next-app/ directory\necho \"=== Build Check ===\" && npm run build 2>&1 | tail -20\necho \"=== TypeScript ===\" && npx tsc --noEmit 2>&1 | head -20\necho \"=== Lint ===\" && npm run lint 2>&1 | head -20\necho \"=== Git Status ===\" && git status --short\n```\n\n### Supabase RLS Diagnosis\n\n```bash\n# Check if RLS is blocking queries (most common issue!)\nnode -e \"\nconst { createClient } = require('@supabase/supabase-js');\nconst supabase = createClient(\n  'YOUR_SUPABASE_URL',\n  'YOUR_ANON_KEY'\n);\n\nasync function diagnose() {\n  // Test as anonymous user\n  const { data, error, count } = await supabase\n    .from('YOUR_TABLE')\n    .select('*', { count: 'exact' })\n    .limit(5);\n\n  console.log('Error:', error);\n  console.log('Count:', count);\n  console.log('Sample:', data);\n}\ndiagnose();\n\"\n```\n\n### Worker Health Check\n\n```bash\n# Check if workers are responding\ncurl -s -o /dev/null -w \"%{http_code}\" https://YOUR-WORKER.workers.dev/health\n\n# Check CORS headers\ncurl -s -D - -o /dev/null -H \"Origin: https://yoursite.com\" \\\n  https://YOUR-WORKER.workers.dev/api/endpoint | grep -iE \"(access-control|x-)\"\n\n# Stream worker logs\ncd workers/your-worker && npx wrangler tail\n```\n\n### Cache Inspection\n\n```bash\n# Check Cloudflare KV cache\nnpx wrangler kv:key list --namespace-id=YOUR_NAMESPACE_ID | head -20\n\n# Get specific cached value\nnpx wrangler kv:key get --namespace-id=YOUR_NAMESPACE_ID \"cache:key\"\n\n# Clear a cached item\nnpx wrangler kv:key delete --namespace-id=YOUR_NAMESPACE_ID \"cache:key\"\n```\n\n## Common Issues & Solutions\n\n### 1. RLS Policy Blocking Data (Most Common!)\n\n**Symptoms:**\n- Query returns empty array but no error\n- Works in Supabase dashboard but not in app\n- Works for some users but not others\n\n**Diagnosis:**\n```sql\n-- In Supabase SQL Editor\n-- Check what policies exist\nSELECT schemaname, tablename, policyname, permissive, roles, cmd, qual\nFROM pg_policies\nWHERE tablename = 'your_table';\n\n-- Test as anonymous user\nSET ROLE anon;\nSELECT * FROM your_table LIMIT 5;\nRESET ROLE;\n\n-- Test as authenticated user\nSET ROLE authenticated;\nSET request.jwt.claims = '{\"sub\": \"user-uuid-here\"}';\nSELECT * FROM your_table LIMIT 5;\nRESET ROLE;\n```\n\n**Common Fixes:**\n```sql\n-- Allow public read access\nCREATE POLICY \"Allow public read\" ON your_table\n  FOR SELECT USING (true);\n\n-- Allow authenticated users to read\nCREATE POLICY \"Allow authenticated read\" ON your_table\n  FOR SELECT TO authenticated USING (true);\n\n-- Allow users to read their own data\nCREATE POLICY \"Users read own data\" ON your_table\n  FOR SELECT USING (auth.uid() = user_id);\n```\n\n### 2. CORS Errors\n\n**Symptoms:**\n- \"Access to fetch blocked by CORS policy\"\n- Works in Postman but not in browser\n- Preflight request fails\n\n**Diagnosis:**\n```bash\n# Check what CORS headers are returned\ncurl -s -D - -o /dev/null \\\n  -H \"Origin: https://yoursite.com\" \\\n  -H \"Access-Control-Request-Method: POST\" \\\n  -X OPTIONS \\\n  https://your-worker.workers.dev/api/endpoint\n```\n\n**Fix in Cloudflare Worker:**\n```typescript\n// In your worker\nconst corsHeaders = {\n  'Access-Control-Allow-Origin': '*', // Or specific domain\n  'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\n  'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n};\n\n// Handle preflight\nif (request.method === 'OPTIONS') {\n  return new Response(null, { headers: corsHeaders });\n}\n\n// Add to all responses\nreturn new Response(data, {\n  headers: { ...corsHeaders, 'Content-Type': 'application/json' }\n});\n```\n\n### 3. Auth State Not Persisting\n\n**Symptoms:**\n- User logged in but shows as logged out on refresh\n- Auth works locally but not in production\n- Session disappears randomly\n\n**Diagnosis:**\n```javascript\n// In browser console\nconsole.log('Session:', await supabase.auth.getSession());\nconsole.log('User:', await supabase.auth.getUser());\nconsole.log('LocalStorage:', Object.keys(localStorage).filter(k => k.includes('supabase')));\n```\n\n**Common Fixes:**\n- Check Supabase URL matches (http vs https, trailing slash)\n- Verify site URL in Supabase Auth settings\n- Check for cookie blocking (Safari, incognito)\n- Ensure AuthContext wraps all components needing auth\n\n### 4. Hydration Mismatch\n\n**Symptoms:**\n- \"Hydration failed because the initial UI does not match\"\n- Content flashes on page load\n- Different content on server vs client\n\n**Diagnosis:**\n```typescript\n// Temporarily add to suspect component\nuseEffect(() => {\n  console.log('Client render:', document.body.innerHTML.slice(0, 500));\n}, []);\n```\n\n**Common Fixes:**\n```typescript\n// Use client-only rendering for dynamic content\n'use client';\nimport { useState, useEffect } from 'react';\n\nfunction DynamicContent() {\n  const [mounted, setMounted] = useState(false);\n  useEffect(() => setMounted(true), []);\n  if (!mounted) return null; // or skeleton\n  return <div>{/* dynamic content */}</div>;\n}\n```\n\n### 5. Worker Not Deploying\n\n**Symptoms:**\n- Deploy command succeeds but changes not reflected\n- Old code still running\n- Intermittent old/new behavior\n\n**Diagnosis:**\n```bash\n# Check deployment status\nnpx wrangler deployments list\n\n# View current worker code\nnpx wrangler deployments view\n\n# Check for multiple environments\nnpx wrangler whoami\n```\n\n**Fixes:**\n```bash\n# Force redeploy\nnpx wrangler deploy --force\n\n# Clear Cloudflare cache\ncurl -X POST \"https://api.cloudflare.com/client/v4/zones/ZONE_ID/purge_cache\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  --data '{\"purge_everything\":true}'\n```\n\n### 6. TypeScript Cache Haunting\n\n**Symptoms:**\n- Errors reference deleted/changed code\n- Types don't match current code\n- \"Cannot find module\" for existing files\n\n**Fix:**\n```bash\n# Nuclear option - clear all caches\nrm -rf .next node_modules/.cache tsconfig.tsbuildinfo\nnpm run build\n\n# Or just TypeScript cache\nrm -rf node_modules/.cache/typescript\nnpx tsc --build --clean\n```\n\n### 7. Static Export Issues\n\n**Symptoms:**\n- \"Error: Page X couldn't be rendered statically\"\n- Dynamic routes fail in static export\n- API routes don't work after deploy\n\n**Diagnosis:**\n```bash\n# Check next.config for output mode\ngrep -A5 \"output:\" next.config.ts\n\n# Find dynamic components\ngrep -r \"useSearchParams\\|usePathname\\|cookies()\\|headers()\" src/\n```\n\n**Fixes:**\n```typescript\n// For components using dynamic APIs\nexport const dynamic = 'force-dynamic';\n// or wrap in Suspense with fallback\n\n// For generateStaticParams\nexport async function generateStaticParams() {\n  return [{ slug: 'page1' }, { slug: 'page2' }];\n}\n```\n\n### 8. Rate Limiting Issues\n\n**Symptoms:**\n- 429 errors after several requests\n- Works initially then stops\n- Different behavior per IP\n\n**Diagnosis:**\n```bash\n# Check rate limit headers\ncurl -i https://your-worker.workers.dev/api/endpoint 2>&1 | grep -i ratelimit\n\n# Check KV for rate limit keys\nnpx wrangler kv:key list --namespace-id=RATE_LIMIT_KV_ID | grep rate\n```\n\n**Fixes:**\n```bash\n# Clear rate limit for an IP\nnpx wrangler kv:key delete --namespace-id=RATE_LIMIT_KV_ID \"rate:192.168.1.1\"\n\n# Adjust limits in wrangler.toml\nRATE_LIMIT_REQUESTS = \"100\"\nRATE_LIMIT_WINDOW = \"3600\"\n```\n\n### 9. Meeting/Location Data Issues\n\n**Symptoms:**\n- No meetings found in certain areas\n- Stale meeting data\n- Cache showing wrong data\n\n**Diagnosis:**\n```bash\n# Check cache status for a location\ncurl -s -D - -o /dev/null \\\n  -H \"Origin: https://yoursite.com\" \\\n  \"https://your-proxy.workers.dev/api/all?lat=45.52&lng=-122.68&radius=25\" \\\n  | grep -iE \"(x-cache|x-geohash|x-source)\"\n\n# Force cache refresh\ncurl -H \"Origin: https://yoursite.com\" \\\n  \"https://your-proxy.workers.dev/warm\"\n\n# Check Supabase for meeting count\nnode -e \"\nconst { createClient } = require('@supabase/supabase-js');\nconst supabase = createClient('URL', 'KEY');\nsupabase.from('meetings').select('*', { count: 'exact', head: true })\n  .then(({count}) => console.log('Total meetings:', count));\n\"\n```\n\n### 10. Build Fails on Cloudflare Pages\n\n**Symptoms:**\n- Works locally but fails on deploy\n- \"Module not found\" errors\n- Memory exceeded\n\n**Diagnosis:**\n```bash\n# Check build output locally\nNODE_ENV=production npm run build 2>&1 | tee build.log\n\n# Check for conditional imports\ngrep -r \"require(\" src/ --include=\"*.ts\" --include=\"*.tsx\"\n\n# Check bundle size\nnpx next-bundle-analyzer\n```\n\n**Fixes:**\n```javascript\n// next.config.ts - increase memory\nmodule.exports = {\n  experimental: {\n    memoryBasedWorkersCount: true,\n  },\n  // Reduce bundle size\n  webpack: (config) => {\n    config.externals = [...(config.externals || []), 'sharp'];\n    return config;\n  }\n};\n```\n\n## Debug Scripts\n\n### `scripts/diagnose.sh`\n```bash\n#!/bin/bash\n# Run all diagnostics\n\necho \"=== Environment ===\"\nnode -v && npm -v\n\necho \"=== Dependencies ===\"\nnpm ls --depth=0 2>&1 | grep -E \"(UNMET|missing)\"\n\necho \"=== TypeScript ===\"\nnpx tsc --noEmit 2>&1 | head -30\n\necho \"=== Build ===\"\nnpm run build 2>&1 | tail -30\n\necho \"=== Workers ===\"\nfor worker in workers/*/; do\n  echo \"Worker: $worker\"\n  (cd \"$worker\" && npx wrangler whoami 2>/dev/null)\ndone\n\necho \"=== Supabase ===\"\nnpx supabase status 2>/dev/null || echo \"Supabase CLI not configured\"\n```\n\n### `scripts/check-rls.js`\n```javascript\n// Check RLS policies are working correctly\nconst { createClient } = require('@supabase/supabase-js');\n\nconst supabase = createClient(\n  process.env.NEXT_PUBLIC_SUPABASE_URL,\n  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n);\n\nasync function checkTable(table) {\n  console.log(`\\n=== Checking ${table} ===`);\n  const { data, error, count } = await supabase\n    .from(table)\n    .select('*', { count: 'exact' })\n    .limit(1);\n\n  if (error) {\n    console.log(`ERROR: ${error.message}`);\n  } else {\n    console.log(`OK: ${count} rows accessible`);\n  }\n}\n\n// Check critical tables\n['profiles', 'meetings', 'forum_posts', 'journal_entries'].forEach(checkTable);\n```\n\n## Validation Checklist\n\n```\n[ ] Can reproduce the issue consistently\n[ ] Identified which layer is failing (client/Next/Worker/Supabase/API)\n[ ] Checked browser console for errors\n[ ] Checked network tab for failed requests\n[ ] Checked worker logs (wrangler tail)\n[ ] Verified RLS policies allow access\n[ ] Tested with fresh browser/incognito\n[ ] Cleared all caches (browser, React Query, KV, TS)\n[ ] Checked environment variables match production\n[ ] Verified CORS headers are correct\n[ ] Tested on production URL (not just localhost)\n[ ] Created minimal reproduction case\n```\n\n## Output\n\nWhen debugging, always provide:\n1. **Root cause** - What exactly was wrong\n2. **Evidence** - Logs, errors, or queries that proved it\n3. **Fix** - Minimal code change to resolve\n4. **Verification** - How to confirm it's fixed\n5. **Prevention** - How to avoid this in future\n\n## Tools Available\n\n- `Read`, `Write`, `Edit` - File operations\n- `Bash` - Run commands, curl, wrangler\n- `Grep`, `Glob` - Search codebase\n- `WebFetch` - Test endpoints\n- `mcp__supabase__*` - Direct Supabase operations\n- `mcp__playwright__*` - Browser automation for UI testing\n"
    }
  ]
}